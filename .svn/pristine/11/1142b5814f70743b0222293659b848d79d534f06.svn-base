{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\player.js"],"names":["FSM","require","Stand","Jump","Walk","Slide","Squat","Fire","Fall","Swim","Float","ToBig","ToSmall","FlashCatchMonster","FlashCatchFlower","FlashCatchStar","Die","Climb","Actor","AiCtrl","MoveCmd","cc","Class","extends","properties","vMaxAcceleration","vMinAcceleration","vOrignSpeed","vSpeOrignSpeed","vFallMaxSpeed","vWaterMinAcceleration","vWaterOrignSpeed","hCurrMaxSpeed","hNorAcceleration","hNorMaxSpeed","hNorSlowAcceleration","hSpeAcceleration","hSpeMaxSpeed","hSpeSlowAcceleration","hWaterAcceleration","hWaterMaxSpeed","hWaterSlowSpeed","flashAtlas","type","SpriteAtlas","default","behind","Node","front","init","dir","DIR","DIR_RIGHT","playerState","PLAYER_STATE","STAND","formState","global","getPlayerState","isOnWater","isInvincible","isFlashing","isOnLand","enableInput","isKPressed","isAPressed","isDPressed","isSPressed","isJPressed","isWPressed","oldPos","node","position","isDie","isTouchLand","isOnCirrus","isCollsiFlag","isOnLadder","animation","getComponent","Animation","aiCtrl","fsm","addState","setDefaultState","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","EM","FLAG_TOUCH_LAND","flagTouchLand","releaseAllKey","addCmd","macro","KEY","d","j","getFirePos","x","y","v2","setDir","setPlayerState","state","setFormState","emit","CHANGE_STATE","getDir","getFormState","getSize","size","getContentSize","width","hCurrSpeed","rect","height","getDie","event","handleInput","keyCode","a","k","s","start","update","dt","isPause","enableMove","backPos","move","vCurrSpeed","Math","abs","setTimeout","ADD_LIFE","GAME_OVER","bind","removeFromParent","STOP_READTIME","enableCollsi","tile","getUpCollsiTile","log","TILE_TYPE","LAND","PIPE_H_ENTRY","PIPE_V_ENTRY","collsiTop","WALL","gm","mapMgr","pushWall","QUESTION","pushQuestion","HIDE_QUESTION","isUpOrDown","pushHideQuestion","COIN","collsiCoin","getDownCollsiTile","collsiDown","vPipeEntry","FLAG","collsiFlag","getRightCollsiTile","collsiRight","hPipeEntry","getLeftCollsiTile","collsiLeft","CLIMB","vCurrAcceleration","posType","getObjectAt","posMgr","posObjects","WALK","switchState","DIR_LEFT","fixOffset","sizeOne","sizeTwo","actorCollsition","COLLSI_FLAG","isLeftOrRight","littleJump","fire","bulletMgr","enableFire","pos","CREATE_P_BULLET","switchStateWithStack","onDestroy","off","pause","resume"],"mappings":"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","file":"player.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\nvar FSM=require(\"FSM\");\r\nvar {Stand,Jump,Walk,Slide,Squat,Fire,Fall,Swim,Float,ToBig,ToSmall,FlashCatchMonster,FlashCatchFlower,FlashCatchStar,Die,Climb}=require(\"playerState\");\r\nvar Actor=require(\"actor\");\r\nvar {AiCtrl,MoveCmd}=require(\"aiCtrl\");\r\ncc.Class({\r\n    extends: Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        //垂直方向的变量\r\n        vMaxAcceleration:-3800,                   //最大加速度\r\n        vMinAcceleration:-1320,                   //最小加速度\r\n \r\n        vOrignSpeed:660,                        //跳跃初始速度\r\n        vSpeOrignSpeed:744,                     //加速时的初始速度\r\n\r\n        vFallMaxSpeed:-600,\r\n        //水中\r\n        vWaterMinAcceleration:-750,\r\n        vWaterOrignSpeed:300,\r\n\r\n        //水平方向的变量\r\n\r\n        hCurrMaxSpeed:0,                      //当前速度限制（马里奥按下加速键时，速度上限会提升，当前加速度也会提升）\r\n        hNorAcceleration:250,                   //正常情况下的加速度\r\n        hNorMaxSpeed:220,                       //正常下的速度限制\r\n        hNorSlowAcceleration:-500,               //正常下的减速加速度\r\n        hSpeAcceleration:640,                   //加速下的加速度\r\n        hSpeMaxSpeed:320,                       //加速下的速度限制\r\n        hSpeSlowAcceleration:-850,                //加速下的减速加速度\r\n        hWaterAcceleration:220,\r\n        hWaterMaxSpeed:160,\r\n        hWaterSlowSpeed:-100,\r\n\r\n        flashAtlas:{\r\n            type:cc.SpriteAtlas,\r\n            default:[]\r\n        },\r\n        behind:cc.Node,\r\n        front:cc.Node\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    init() {\r\n        this.dir=DIR.DIR_RIGHT;                              //方向\r\n        this.playerState=PLAYER_STATE.STAND;                //玩家状态\r\n        this.formState=global.getPlayerState();                    //形态\r\n        this.isOnWater=false;   \r\n        this.isInvincible=false;                            //是否无敌\r\n        this.isFlashing=false;                              //是否闪烁（得到星星\r\n        this.isOnLand=true;\r\n        this.enableInput=true;\r\n\r\n        this.isKPressed=false;\r\n        this.isAPressed=false;\r\n        this.isDPressed=false;\r\n        this.isSPressed=false;\r\n        this.isJPressed=false;\r\n        this.isWPressed=false;\r\n        this.oldPos=this.node.position;\r\n        this.isDie=false;\r\n        this.isTouchLand=false;\r\n        this.isOnCirrus=false;                             //是否在藤蔓上\r\n        this.isCollsiFlag=false;                            //是否碰到旗帜\r\n        this.isOnLadder=false;\r\n        this.animation=this.behind.getComponent(cc.Animation);\r\n        this.aiCtrl=new AiCtrl();\r\n\r\n        this.fsm=new FSM();\r\n        this.fsm.addState(new Stand(this,\"stand\"));\r\n        this.fsm.addState(new Jump(this,\"jump\"));\r\n        this.fsm.addState(new Walk(this,\"walk\"));\r\n        this.fsm.addState(new Slide(this,\"slide\"));\r\n        this.fsm.addState(new Squat(this,\"squat\"));\r\n        this.fsm.addState(new Fire(this,\"fire\"));\r\n        this.fsm.addState(new Fall(this,\"fall\"));\r\n        this.fsm.addState(new Swim(this,\"swim\"));\r\n        this.fsm.addState(new Float(this,\"float\"));\r\n        this.fsm.addState(new ToBig(this,\"to_big\"));\r\n        this.fsm.addState(new ToSmall(this,\"to_small\"));\r\n        this.fsm.addState(new Die(this,\"die\"));\r\n        this.fsm.addState(new Climb(this,\"climb\"));\r\n        this.fsm.addState(new FlashCatchMonster(this,\"flash_catch_monster\"));\r\n        this.fsm.addState(new FlashCatchFlower(this,\"flash_catch_flower\"));\r\n        this.fsm.addState(new FlashCatchStar(this,\"flash_catch_star\"));\r\n        this.fsm.setDefaultState(\"stand\");\r\n\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this);\r\n\r\n        EM.on(EM.type.FLAG_TOUCH_LAND,this.flagTouchLand,this);\r\n    },\r\n    releaseAllKey(){\r\n        this.isKPressed=false;\r\n        this.isAPressed=false;\r\n        this.isDPressed=false;\r\n        this.isSPressed=false;\r\n        this.isJPressed=false;\r\n        this.isWPressed=false;\r\n    },\r\n    flagTouchLand(){\r\n        //this.enableInput=true;\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.d,\"keydown\"));\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.d,\"keyup\"));\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.d,\"keydown\"));\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.j,\"keyup\"));\r\n    },\r\n    getFirePos(){\r\n        let x=0;\r\n        let y=this.node.y+50;\r\n        this.dir===DIR.DIR_RIGHT?x=this.node.x+20:x=this.node.x-20;\r\n        return cc.v2(x,y);\r\n    },\r\n    setDir(dir){\r\n        this.dir=dir;\r\n    },\r\n    setPlayerState(state){\r\n        this.playerState=state;\r\n    },\r\n    setFormState(state){\r\n        this.formState=state;\r\n        EM.emit(EM.type.CHANGE_STATE,state);\r\n    },\r\n    getDir(){\r\n        return this.dir;\r\n    },\r\n    getPlayerState(){\r\n        return this.playerState;\r\n    },\r\n    getFormState(){\r\n        return this.formState;\r\n    },\r\n    getSize(){\r\n        let size=this.behind.getContentSize();\r\n        let width=this.hCurrSpeed>=this.hSpeMaxSpeed?size.width:size.width-14;\r\n        return cc.rect(this.node.x,this.node.y,width,size.height-4);\r\n    },\r\n    getDie(){\r\n        return this.isDie;\r\n    },\r\n    onKeyDown(event){\r\n        //cc.log(event);   \r\n        if(!this.enableInput)return;\r\n\r\n        this.fsm.handleInput(event);\r\n\r\n        if(event.keyCode===cc.macro.KEY.d){\r\n            this.isDPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.a){\r\n            this.isAPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.k){\r\n            this.isKPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.s){\r\n            this.isSPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.j){\r\n            this.isJPressed=true;\r\n        }\r\n    },\r\n\r\n    onKeyUp(event){\r\n        //cc.log(event);\r\n        if(!this.enableInput)return;\r\n        this.fsm.handleInput(event);\r\n\r\n        if(event.keyCode===cc.macro.KEY.d){\r\n            this.isDPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.a){\r\n            this.isAPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.k){\r\n            this.isKPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.s){\r\n            this.isSPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.j){\r\n            this.isJPressed=false;\r\n        }\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.isPause)return;\r\n\r\n        if(this.enableMove){\r\n            this.backPos();\r\n        \r\n            this.move(dt);\r\n    \r\n            //限制垂直方向下的速度\r\n            if(this.vCurrSpeed<this.vFallMaxSpeed){\r\n                this.vCurrSpeed=this.vFallMaxSpeed;\r\n            }\r\n    \r\n            //限制水平方向的速度\r\n            if(Math.abs(this.hCurrSpeed)>this.hCurrMaxSpeed){\r\n                this.hCurrSpeed=this.hCurrMaxSpeed*(this.hCurrSpeed/Math.abs(this.hCurrSpeed));\r\n            }\r\n    \r\n            //检测是否超过屏幕上下边界\r\n            if(this.node.y<-120||this.node.y>760){\r\n                this.isDie=true;\r\n                setTimeout(function(){\r\n                    //游戏结束\r\n                    EM.emit(EM.type.ADD_LIFE,-1);\r\n                    EM.emit(EM.type.GAME_OVER);\r\n                }.bind(this),2000);\r\n                this.node.removeFromParent();\r\n                EM.emit(EM.type.STOP_READTIME);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if(this.enableCollsi){\r\n        //与墙体的碰撞检测\r\n        let tile=this.getUpCollsiTile();\r\n        if(tile.type){\r\n            cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                    this.collsiTop(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.WALL:\r\n                    this.collsiTop(tile.tile);\r\n                    gm.mapMgr.pushWall(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiTop(tile.tile);\r\n                    gm.mapMgr.pushQuestion(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.HIDE_QUESTION:\r\n                    if(!this.isUpOrDown())break;\r\n                    this.collsiTop(tile.tile);\r\n                    gm.mapMgr.pushHideQuestion(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n            }\r\n        }\r\n\r\n        //脚底的碰撞检测\r\n        tile=this.getDownCollsiTile();\r\n        if(tile.type){\r\n            //cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                    this.collsiDown(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                    this.vPipeEntry(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiDown(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n \r\n                case TILE_TYPE.FLAG:\r\n                    this.collsiFlag(tile.tile);\r\n                break;\r\n            }\r\n        }else{\r\n            if(this.isOnLand&&!this.isOnLadder){\r\n                this.isOnLand=false;\r\n            }\r\n        }\r\n\r\n        //右侧的碰撞检测\r\n        tile=this.getRightCollsiTile();\r\n        if(tile.type){\r\n            cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiRight(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                    this.hPipeEntry(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n                case TILE_TYPE.FLAG:\r\n                    this.collsiFlag(tile.tile);\r\n                break;\r\n            }\r\n        }\r\n\r\n        //左侧的碰撞检测\r\n        tile=this.getLeftCollsiTile();\r\n        if(tile.type){\r\n            cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiLeft(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                    //this.hPipeEntry(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n                case TILE_TYPE.FLAG:\r\n                    this.collsiFlag(tile.tile);\r\n                break;\r\n            }\r\n        }\r\n        this.aiCtrl.update(dt);\r\n        this.fsm.update(dt);\r\n        }\r\n\r\n    },\r\n    collsiDown(tile){\r\n        let size=this.getSize();\r\n        if(!this.isOnLand){\r\n            if((this.oldPos.y>=tile.node.y)\r\n            &&((this.oldPos.x-size.width/2>=tile.node.x&&this.oldPos.x-size.width/2<=tile.node.x+40)\r\n            ||(this.oldPos.x+size.width/2>=tile.node.x&&this.oldPos.x+size.width/2<=tile.node.x+40))){\r\n                if(this.playerState!==PLAYER_STATE.CLIMB){    \r\n                    this.isOnLand=true;\r\n                }\r\n                this.isTouchLand=true;\r\n                this.node.y=tile.node.y+40;\r\n                this.vCurrSpeed=0;\r\n                this.vCurrAcceleration=0;\r\n            }\r\n        }\r\n    },\r\n    hPipeEntry(tile){\r\n        let posType=gm.mapMgr.getObjectAt(gm.posMgr.posObjects,cc.v2(tile.x,tile.y));\r\n        if(posType){\r\n            if(this.playerState!==PLAYER_STATE.WALK){\r\n                this.fsm.switchState(\"walk\");\r\n            }\r\n            this.isPause=true;\r\n            this.enableInput=false;\r\n            this.releaseAllKey();\r\n            gm.posMgr.hPipeEntry(posType,cc.v2(tile.node.x+20,tile.node.y));\r\n        }else{\r\n            this.collsiRight(tile);\r\n        }\r\n    },\r\n    vPipeEntry(tile){\r\n        let posType=gm.mapMgr.getObjectAt(gm.posMgr.posObjects,cc.v2(tile.x,tile.y));\r\n        if(posType&&this.node.x>tile.node.x+20&&this.isSPressed){\r\n            this.isPause=true;\r\n            this.enableInput=false;\r\n            this.releaseAllKey();\r\n            gm.posMgr.vPipeEntry(posType,cc.v2(tile.node.x+20,tile.node.y));\r\n        }else{\r\n            this.collsiDown(tile);\r\n        }\r\n    },\r\n    collsiLeft(tile){\r\n        if(this.dir===DIR.DIR_LEFT)this.hCurrSpeed=0;\r\n        this.node.x=this.getSize().width/2+tile.node.x+40+1;\r\n        gm.fixOffset(this.node.position);\r\n    },\r\n    collsiRight(tile){\r\n        if(this.dir===DIR.DIR_RIGHT)this.hCurrSpeed=0;\r\n        this.node.x=tile.node.x-this.getSize().width/2-1; \r\n    },\r\n    collsiTop(tile){\r\n        this.vCurrSpeed=0;\r\n        this.node.y=tile.node.y-this.getSize().size.height-1;\r\n    },\r\n    collsiFlag(tile){\r\n        if(this.isOnCirrus)return;\r\n        let sizeOne=cc.rect(tile.node.x+20,tile.node.y,10,40);\r\n        let sizeTwo=this.getSize();\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            this.isOnCirrus=true;\r\n            this.isCollsiFlag=true;\r\n            this.enableInput=false;\r\n            this.node.x=sizeOne.x-10;\r\n            this.releaseAllKey();\r\n            this.fsm.switchState(\"climb\");            \r\n            this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.s,\"keydown\"));      \r\n            EM.emit(EM.type.COLLSI_FLAG);\r\n        }\r\n    },\r\n    isUpOrDown(){\r\n        return this.vCurrSpeed>0?true:false;\r\n    },\r\n    isLeftOrRight(){\r\n        return this.hCurrSpeed>0?false:true;\r\n    },\r\n    //小跳（踩到怪物\r\n    littleJump(){\r\n        this.vCurrSpeed=600;\r\n    },\r\n    fire(){\r\n        if(!gm.bulletMgr.enableFire())return;\r\n        let pos=this.getFirePos();\r\n        EM.emit(EM.type.CREATE_P_BULLET,pos,this.dir);\r\n        this.fsm.switchStateWithStack(\"fire\");\r\n    },\r\n    onDestroy(){\r\n        EM.off(EM.type.FLAG_TOUCH_LAND);\r\n    },\r\n    pause(){\r\n        this.animation.pause();\r\n        this.isPause=true;\r\n    },\r\n    resume(){\r\n        this.isPause=false;\r\n        this.animation.resume();\r\n    }\r\n});\r\n"]}