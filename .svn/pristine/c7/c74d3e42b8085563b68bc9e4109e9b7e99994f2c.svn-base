{"version":3,"sources":["boss.js"],"names":["Actor","require","FSM","Walk","Fire","TopTurn","Die","cc","Class","extends","properties","init","node","zIndex","life","orignPos","position","dir","DIR","DIR_LEFT","aex","arguments","fsm","animation","getComponent","Animation","addState","setDefaultState","moveLeft","moveBy","v2","runAction","repeatForever","sequence","reverse","schedule","jump","fire","vCurrSpeed","vCurrAcceleration","switchStateWithStack","getSize","size","getContentSize","rect","x","y","width","height","getFirePos","DIR_RIGHT","getDesFireY","Math","floor","random","turnLeft","scaleX","turnRight","onCollsiWithPBullet","bullet","die","switchState","interactive","actor","isDie","sizeOne","sizeTwo","actorCollsition","isFlashing","isInvincible","getFormState","FORM_STATE","SMALL","update","dt","isPause","enableMove","move","tile","getDownCollsiTile","type","TILE_TYPE","LAND","PIPE_H_ENTRY","WALL","PIPE_V_ENTRY","QUESTION","isOnLand"],"mappings":"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","file":"boss.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\monster","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar Actor=require(\"actor\");\r\nvar FSM=require(\"FSM\");\r\nvar {Walk,Fire,TopTurn,Die}=require(\"bossState\");\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    init(){\r\n        this.node.zIndex=100;\r\n        this.life=10;\r\n        this.orignPos=this.node.position;\r\n        this.dir=DIR.DIR_LEFT;\r\n        //是否允许使用斧子\r\n        this.aex=arguments[1];\r\n        this.fsm=new FSM();\r\n        this.animation=this.node.getComponent(cc.Animation);\r\n        this.fsm.addState(new Walk(this,\"walk\"));\r\n        this.fsm.addState(new Fire(this,\"fire\"));\r\n        this.fsm.addState(new TopTurn(this,\"updown\"));\r\n        this.fsm.addState(new Die(this,\"die\"));\r\n        this.fsm.setDefaultState(\"walk\");\r\n        //boss来回运动\r\n        let moveLeft=cc.moveBy(10,cc.v2(-360,0));\r\n        this.node.runAction(cc.repeatForever(cc.sequence(moveLeft,moveLeft.reverse())));\r\n\r\n        this.schedule(this.jump,4);\r\n\r\n        this.schedule(this.fire,3);\r\n    },\r\n    jump(){\r\n        this.vCurrSpeed=400;\r\n        this.vCurrAcceleration=-800;\r\n    },\r\n    fire(){\r\n        this.fsm.switchStateWithStack(\"fire\");\r\n    },\r\n    getSize(){\r\n        let size=this.node.getContentSize();\r\n        return cc.rect(this.node.x,this.node.y,size.width,size.height);\r\n    },\r\n    getFirePos(){\r\n        switch(this.dir){\r\n            case DIR.DIR_LEFT:return cc.v2(this.node.x-20,this.node.y+40);\r\n            case DIR.DIR_RIGHT:return cc.v2(this.node.x+20,this.node.y+40);\r\n        }\r\n    },\r\n    getDesFireY(){\r\n        return this.orignPos.y+Math.floor(Math.random()*4)*40;\r\n    },\r\n    turnLeft(){\r\n        this.node.scaleX=1;\r\n        this.dir=DIR.DIR_LEFT;\r\n    },\r\n    turnRight(){    \r\n        this.node.scaleX=-1;\r\n        this.dir=DIR.DIR_RIGHT;\r\n    },\r\n    onCollsiWithPBullet(bullet){\r\n        bullet.die();\r\n        if(this.life--<=0){\r\n            this.fsm.switchState(\"updown\");\r\n        }\r\n    },\r\n    interactive(actor){\r\n        if(actor.isDie||this.isDie)return;\r\n        let sizeOne=actor.getSize();\r\n        let sizeTwo=this.getSize();\r\n\r\n        if(sizeOne.x>sizeTwo.x&&this.dir===DIR.DIR_LEFT){\r\n            this.turnRight();\r\n        }else if(sizeOne.x<sizeTwo.x&&this.dir===DIR.DIR_RIGHT){\r\n            this.turnLeft();\r\n        }\r\n\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            //闪烁状态碰到怪物\r\n            if(!actor.isFlashing&&!actor.isInvincible){\r\n                if(actor.getFormState()!==FORM_STATE.SMALL){\r\n                    actor.fsm.switchStateWithStack(\"to_small\");\r\n                }else{\r\n                    actor.fsm.switchState(\"die\");\r\n                }\r\n            }\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    \r\n    // onLoad () {}\r\n\r\n    update (dt) {\r\n        if(this.isPause)return;\r\n\r\n        if(this.enableMove){\r\n            this.move(dt);\r\n        }\r\n\r\n        let tile=null;\r\n\r\n        //脚底的碰撞检测\r\n        tile=this.getDownCollsiTile();\r\n        if(tile.type){\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                case TILE_TYPE.PIPE_V_ENTRY:  \r\n                case TILE_TYPE.QUESTION:\r\n                this.node.y=this.orignPos.y;\r\n                this.vCurrAcceleration=0;\r\n                this.vCurrSpeed=0;\r\n                break;                    \r\n            }\r\n        }else{\r\n            if(this.isOnLand){\r\n                this.isOnLand=false;\r\n            }\r\n        }\r\n\r\n    }\r\n});\r\n"]}