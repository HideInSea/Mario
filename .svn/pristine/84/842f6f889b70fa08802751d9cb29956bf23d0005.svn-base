{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\player.js"],"names":["FSM","require","Stand","Jump","Walk","Slide","Squat","Fire","Fall","Swim","Float","ToBig","ToSmall","FlashCatchMonster","FlashCatchFlower","FlashCatchStar","Die","Climb","Actor","AiCtrl","MoveCmd","cc","Class","extends","properties","vMaxAcceleration","vMinAcceleration","vOrignSpeed","vSpeOrignSpeed","vFallMaxSpeed","vWaterMinAcceleration","vWaterOrignSpeed","hCurrMaxSpeed","hNorAcceleration","hNorMaxSpeed","hNorSlowAcceleration","hSpeAcceleration","hSpeMaxSpeed","hSpeSlowAcceleration","hWaterAcceleration","hWaterMaxSpeed","hWaterSlowSpeed","flashAtlas","type","SpriteAtlas","default","behind","Node","front","init","roadCheck","dir","DIR","DIR_RIGHT","playerState","PLAYER_STATE","STAND","formState","global","getPlayerState","isOnWater","isInvincible","isFlashing","isOnLand","enableInput","isKPressed","isAPressed","isDPressed","isSPressed","isJPressed","isWPressed","oldPos","node","position","isDie","isTouchLand","isOnCirrus","isCollsiFlag","isOnLadder","animation","getComponent","Animation","aiCtrl","fsm","addState","setDefaultState","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","EM","FLAG_TOUCH_LAND","flagTouchLand","releaseAllKey","addCmd","macro","KEY","d","j","getFirePos","x","y","v2","setDir","setPlayerState","state","setFormState","emit","CHANGE_STATE","getDir","getFormState","getSize","size","getContentSize","width","hCurrSpeed","rect","height","getDie","event","handleInput","keyCode","a","k","s","start","update","dt","isPlayerOnWater","schedule","bubble","unschedule","isPause","enableMove","backPos","move","vCurrSpeed","Math","abs","setTimeout","ADD_LIFE","GAME_OVER","bind","removeFromParent","STOP_READTIME","enableCollsi","tile","getUpCollsiTile","log","TILE_TYPE","LAND","PIPE_H_ENTRY","PIPE_V_ENTRY","collsiTop","WALL","gm","mapMgr","pushWall","QUESTION","pushQuestion","HIDE_QUESTION","isUpOrDown","pushHideQuestion","COIN","collsiCoin","getDownCollsiTile","collsiDown","vPipeEntry","FLAG","collsiFlag","getRightCollsiTile","collsiRight","hPipeEntry","getLeftCollsiTile","collsiLeft","CLIMB","vCurrAcceleration","posType","getObjectAt","posMgr","posObjects","WALK","switchState","DIR_LEFT","fixOffset","sizeOne","sizeTwo","actorCollsition","COLLSI_FLAG","isLeftOrRight","littleJump","fire","bulletMgr","enableFire","pos","CREATE_P_BULLET","switchStateWithStack","onDestroy","off","pause","resume","getCenterPos","waterLayer","tilePos","toTiledPos","mapSize","gid","getTileGIDAt","CREATE_PROP"],"mappings":"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","file":"player.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\nvar FSM=require(\"FSM\");\r\nvar {Stand,Jump,Walk,Slide,Squat,Fire,Fall,Swim,Float,ToBig,ToSmall,FlashCatchMonster,FlashCatchFlower,FlashCatchStar,Die,Climb}=require(\"playerState\");\r\nvar Actor=require(\"actor\");\r\nvar {AiCtrl,MoveCmd}=require(\"aiCtrl\");\r\ncc.Class({\r\n    extends: Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        //垂直方向的变量\r\n        vMaxAcceleration:-3800,                   //最大加速度\r\n        vMinAcceleration:-1320,                   //最小加速度\r\n \r\n        vOrignSpeed:660,                        //跳跃初始速度\r\n        vSpeOrignSpeed:744,                     //加速时的初始速度\r\n\r\n        vFallMaxSpeed:-600,\r\n        //水中\r\n        vWaterMinAcceleration:-750,\r\n        vWaterOrignSpeed:300,\r\n\r\n        //水平方向的变量\r\n\r\n        hCurrMaxSpeed:0,                      //当前速度限制（马里奥按下加速键时，速度上限会提升，当前加速度也会提升）\r\n        hNorAcceleration:250,                   //正常情况下的加速度\r\n        hNorMaxSpeed:220,                       //正常下的速度限制\r\n        hNorSlowAcceleration:-500,               //正常下的减速加速度\r\n        hSpeAcceleration:640,                   //加速下的加速度\r\n        hSpeMaxSpeed:320,                       //加速下的速度限制\r\n        hSpeSlowAcceleration:-850,                //加速下的减速加速度\r\n        hWaterAcceleration:220,\r\n        hWaterMaxSpeed:160,\r\n        hWaterSlowSpeed:-100,\r\n\r\n        flashAtlas:{\r\n            type:cc.SpriteAtlas,\r\n            default:[]\r\n        },\r\n        behind:cc.Node,\r\n        front:cc.Node\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    init() {\r\n        this.roadCheck=0;                                   //正确路线的条数\r\n        \r\n        this.dir=DIR.DIR_RIGHT;                              //方向\r\n        this.playerState=PLAYER_STATE.STAND;                //玩家状态\r\n        this.formState=global.getPlayerState();                    //形态\r\n        this.isOnWater=false;   \r\n        this.isInvincible=false;                            //是否无敌\r\n        this.isFlashing=false;                              //是否闪烁（得到星星\r\n        this.isOnLand=true;\r\n        this.enableInput=true;\r\n\r\n        this.isKPressed=false;\r\n        this.isAPressed=false;\r\n        this.isDPressed=false;\r\n        this.isSPressed=false;\r\n        this.isJPressed=false;\r\n        this.isWPressed=false;\r\n        this.oldPos=this.node.position;\r\n        this.isDie=false;\r\n        this.isTouchLand=false;\r\n        this.isOnCirrus=false;                             //是否在藤蔓上\r\n        this.isCollsiFlag=false;                            //是否碰到旗帜\r\n        this.isOnLadder=false;\r\n        this.animation=this.behind.getComponent(cc.Animation);\r\n        this.aiCtrl=new AiCtrl();\r\n\r\n        this.fsm=new FSM();\r\n        this.fsm.addState(new Stand(this,\"stand\"));\r\n        this.fsm.addState(new Jump(this,\"jump\"));\r\n        this.fsm.addState(new Walk(this,\"walk\"));\r\n        this.fsm.addState(new Slide(this,\"slide\"));\r\n        this.fsm.addState(new Squat(this,\"squat\"));\r\n        this.fsm.addState(new Fire(this,\"fire\"));\r\n        this.fsm.addState(new Fall(this,\"fall\"));\r\n        this.fsm.addState(new Swim(this,\"swim\"));\r\n        this.fsm.addState(new Float(this,\"float\"));\r\n        this.fsm.addState(new ToBig(this,\"to_big\"));\r\n        this.fsm.addState(new ToSmall(this,\"to_small\"));\r\n        this.fsm.addState(new Die(this,\"die\"));\r\n        this.fsm.addState(new Climb(this,\"climb\"));\r\n        this.fsm.addState(new FlashCatchMonster(this,\"flash_catch_monster\"));\r\n        this.fsm.addState(new FlashCatchFlower(this,\"flash_catch_flower\"));\r\n        this.fsm.addState(new FlashCatchStar(this,\"flash_catch_star\"));\r\n        this.fsm.setDefaultState(\"stand\");\r\n\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this);\r\n\r\n        EM.on(EM.type.FLAG_TOUCH_LAND,this.flagTouchLand,this);\r\n    },\r\n    releaseAllKey(){\r\n        this.isKPressed=false;\r\n        this.isAPressed=false;\r\n        this.isDPressed=false;\r\n        this.isSPressed=false;\r\n        this.isJPressed=false;\r\n        this.isWPressed=false;\r\n    },\r\n    flagTouchLand(){\r\n        //this.enableInput=true;\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.d,\"keydown\"));\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.d,\"keyup\"));\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.d,\"keydown\"));\r\n        this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.j,\"keyup\"));\r\n    },\r\n    getFirePos(){\r\n        let x=0;\r\n        let y=this.node.y+50;\r\n        this.dir===DIR.DIR_RIGHT?x=this.node.x+20:x=this.node.x-20;\r\n        return cc.v2(x,y);\r\n    },\r\n    setDir(dir){\r\n        this.dir=dir;\r\n    },\r\n    setPlayerState(state){\r\n        this.playerState=state;\r\n    },\r\n    setFormState(state){\r\n        this.formState=state;\r\n        EM.emit(EM.type.CHANGE_STATE,state);\r\n    },\r\n    getDir(){\r\n        return this.dir;\r\n    },\r\n    getPlayerState(){\r\n        return this.playerState;\r\n    },\r\n    getFormState(){\r\n        return this.formState;\r\n    },\r\n    getSize(){\r\n        let size=this.behind.getContentSize();\r\n        let width=this.hCurrSpeed>=this.hSpeMaxSpeed?size.width:size.width-14;\r\n        return cc.rect(this.node.x,this.node.y,width,size.height-4);\r\n    },\r\n    getDie(){\r\n        return this.isDie;\r\n    },\r\n    onKeyDown(event){\r\n        //cc.log(event);   \r\n        if(!this.enableInput)return;\r\n\r\n        this.fsm.handleInput(event);\r\n\r\n        if(event.keyCode===cc.macro.KEY.d){\r\n            this.isDPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.a){\r\n            this.isAPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.k){\r\n            this.isKPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.s){\r\n            this.isSPressed=true;\r\n        }else if(event.keyCode===cc.macro.KEY.j){\r\n            this.isJPressed=true;\r\n        }\r\n    },\r\n\r\n    onKeyUp(event){\r\n        //cc.log(event);\r\n        if(!this.enableInput)return;\r\n        this.fsm.handleInput(event);\r\n\r\n        if(event.keyCode===cc.macro.KEY.d){\r\n            this.isDPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.a){\r\n            this.isAPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.k){\r\n            this.isKPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.s){\r\n            this.isSPressed=false;\r\n        }else if(event.keyCode===cc.macro.KEY.j){\r\n            this.isJPressed=false;\r\n        }\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n\r\n        if(this.isPlayerOnWater()){\r\n            if(!this.isOnWater){\r\n                this.isOnWater=true;\r\n                this.schedule(this.bubble,1.5);\r\n            }\r\n        }else if(this.isOnWater){\r\n            this.isOnWater=false;\r\n            this.unschedule(this.bubble);\r\n        }\r\n\r\n        \r\n        if(this.isPause)return;\r\n\r\n        if(this.enableMove){\r\n            this.backPos();\r\n        \r\n            this.move(dt);\r\n    \r\n            //限制垂直方向下的速度\r\n            if(this.vCurrSpeed<this.vFallMaxSpeed){\r\n                this.vCurrSpeed=this.vFallMaxSpeed;\r\n            }\r\n    \r\n            //限制水平方向的速度\r\n            if(Math.abs(this.hCurrSpeed)>this.hCurrMaxSpeed){\r\n                this.hCurrSpeed=this.hCurrMaxSpeed*(this.hCurrSpeed/Math.abs(this.hCurrSpeed));\r\n            }\r\n    \r\n            //检测是否超过屏幕上下边界\r\n            if(this.node.y<-120||this.node.y>760){\r\n                this.isDie=true;\r\n                setTimeout(function(){\r\n                    //游戏结束\r\n                    EM.emit(EM.type.ADD_LIFE,-1);\r\n                    EM.emit(EM.type.GAME_OVER);\r\n                }.bind(this),2000);\r\n                this.node.removeFromParent();\r\n                EM.emit(EM.type.STOP_READTIME);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if(this.enableCollsi){\r\n        //与墙体的碰撞检测\r\n        let tile=this.getUpCollsiTile();\r\n        if(tile.type){\r\n            cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                    this.collsiTop(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.WALL:\r\n                    this.collsiTop(tile.tile);\r\n                    gm.mapMgr.pushWall(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiTop(tile.tile);\r\n                    gm.mapMgr.pushQuestion(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.HIDE_QUESTION:\r\n                    if(!this.isUpOrDown())break;\r\n                    this.collsiTop(tile.tile);\r\n                    gm.mapMgr.pushHideQuestion(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n            }\r\n        }\r\n\r\n        //脚底的碰撞检测\r\n        tile=this.getDownCollsiTile();\r\n        if(tile.type){\r\n            //cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                    this.collsiDown(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                    this.vPipeEntry(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiDown(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n \r\n                case TILE_TYPE.FLAG:\r\n                    this.collsiFlag(tile.tile);\r\n                break;\r\n            }\r\n        }else{\r\n            if(this.isOnLand&&!this.isOnLadder){\r\n                this.isOnLand=false;\r\n            }\r\n        }\r\n\r\n        //右侧的碰撞检测\r\n        tile=this.getRightCollsiTile();\r\n        if(tile.type){\r\n            cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiRight(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                    this.hPipeEntry(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n                case TILE_TYPE.FLAG:\r\n                    this.collsiFlag(tile.tile);\r\n                break;\r\n            }\r\n        }\r\n\r\n        //左侧的碰撞检测\r\n        tile=this.getLeftCollsiTile();\r\n        if(tile.type){\r\n            cc.log(tile.type);\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_V_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                case TILE_TYPE.QUESTION:\r\n                    this.collsiLeft(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                    //this.hPipeEntry(tile.tile);\r\n                break;\r\n\r\n                case TILE_TYPE.COIN:\r\n                    gm.mapMgr.collsiCoin(tile.tile);\r\n                break;\r\n                case TILE_TYPE.FLAG:\r\n                    this.collsiFlag(tile.tile);\r\n                break;\r\n            }\r\n        }\r\n        this.aiCtrl.update(dt);\r\n        this.fsm.update(dt);\r\n        }\r\n    },\r\n    collsiDown(tile){\r\n        let size=this.getSize();\r\n        if(!this.isOnLand){\r\n            if((this.oldPos.y>=tile.node.y)\r\n            &&((this.oldPos.x-size.width/2>=tile.node.x&&this.oldPos.x-size.width/2<=tile.node.x+40)\r\n            ||(this.oldPos.x+size.width/2>=tile.node.x&&this.oldPos.x+size.width/2<=tile.node.x+40))){\r\n                if(this.playerState!==PLAYER_STATE.CLIMB){    \r\n                    this.isOnLand=true;\r\n                }\r\n                this.isTouchLand=true;\r\n                this.node.y=tile.node.y+40;\r\n                this.vCurrSpeed=0;\r\n                this.vCurrAcceleration=0;\r\n            }\r\n        }\r\n    },\r\n    hPipeEntry(tile){\r\n        let posType=gm.mapMgr.getObjectAt(gm.posMgr.posObjects,cc.v2(tile.x,tile.y));\r\n        if(posType){\r\n            if(this.playerState!==PLAYER_STATE.WALK){\r\n                this.fsm.switchState(\"walk\");\r\n            }\r\n            this.isPause=true;\r\n            this.enableInput=false;\r\n            this.releaseAllKey();\r\n            gm.posMgr.hPipeEntry(posType,cc.v2(tile.node.x+20,tile.node.y));\r\n        }else{\r\n            this.collsiRight(tile);\r\n        }\r\n    },\r\n    vPipeEntry(tile){\r\n        let posType=gm.mapMgr.getObjectAt(gm.posMgr.posObjects,cc.v2(tile.x,tile.y));\r\n        if(posType&&this.node.x>tile.node.x+20&&this.isSPressed){\r\n            this.isPause=true;\r\n            this.enableInput=false;\r\n            this.releaseAllKey();\r\n            gm.posMgr.vPipeEntry(posType,cc.v2(tile.node.x+20,tile.node.y));\r\n        }else{\r\n            this.collsiDown(tile);\r\n        }\r\n    },\r\n    collsiLeft(tile){\r\n        if(this.dir===DIR.DIR_LEFT)this.hCurrSpeed=0;\r\n        this.node.x=this.getSize().width/2+tile.node.x+40+1;\r\n        gm.fixOffset(this.node.position);\r\n    },\r\n    collsiRight(tile){\r\n        if(this.dir===DIR.DIR_RIGHT)this.hCurrSpeed=0;\r\n        this.node.x=tile.node.x-this.getSize().width/2-1; \r\n    },\r\n    collsiTop(tile){\r\n        this.vCurrSpeed=0;\r\n        this.node.y=tile.node.y-this.getSize().size.height-1;\r\n    },\r\n    collsiFlag(tile){\r\n        if(this.isOnCirrus)return;\r\n        let sizeOne=cc.rect(tile.node.x+20,tile.node.y,10,40);\r\n        let sizeTwo=this.getSize();\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            this.isOnCirrus=true;\r\n            this.isCollsiFlag=true;\r\n            this.enableInput=false;\r\n            this.node.x=sizeOne.x-10;\r\n            this.releaseAllKey();\r\n            this.fsm.switchState(\"climb\");            \r\n            this.aiCtrl.addCmd(new MoveCmd(this,cc.macro.KEY.s,\"keydown\"));      \r\n            EM.emit(EM.type.COLLSI_FLAG);\r\n        }\r\n    },\r\n    isUpOrDown(){\r\n        return this.vCurrSpeed>0?true:false;\r\n    },\r\n    isLeftOrRight(){\r\n        return this.hCurrSpeed>0?false:true;\r\n    },\r\n    //小跳（踩到怪物\r\n    littleJump(){\r\n        this.vCurrSpeed=600;\r\n    },\r\n    fire(){\r\n        if(!gm.bulletMgr.enableFire())return;\r\n        let pos=this.getFirePos();\r\n        EM.emit(EM.type.CREATE_P_BULLET,pos,this.dir);\r\n        this.fsm.switchStateWithStack(\"fire\");\r\n    },\r\n    onDestroy(){\r\n        EM.off(EM.type.FLAG_TOUCH_LAND);\r\n    },\r\n    pause(){\r\n        this.animation.pause();\r\n        this.isPause=true;\r\n    },\r\n    resume(){\r\n        this.isPause=false;\r\n        this.animation.resume();\r\n    },\r\n    getCenterPos(){\r\n        let size=this.behind.getContentSize();\r\n        return cc.v2(this.node.x,this.node.y+size.height/2);\r\n    },\r\n    //检测人物是否在水中\r\n    isPlayerOnWater(){\r\n        if(!gm.mapMgr.waterLayer)return false;\r\n        let tilePos=gm.mapMgr.toTiledPos(this.getCenterPos());\r\n        if(tilePos.x<0||tilePos.x>=gm.mapMgr.mapSize.width||tilePos.y<0||tilePos.y>=gm.mapMgr.mapSize.height)return;\r\n        let gid=gm.mapMgr.waterLayer.getTileGIDAt(tilePos);\r\n        return gid?true:false;\r\n    },\r\n    bubble(){\r\n        let size=this.getSize();\r\n        EM.emit(EM.type.CREATE_PROP,cc.v2(size.x,size.y+size.height),\"bubble\");\r\n    }\r\n});\r\n"]}