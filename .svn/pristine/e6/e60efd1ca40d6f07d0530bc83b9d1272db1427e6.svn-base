{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\gameMgr.js"],"names":["cc","Class","extends","Component","properties","mapMgr","require","propMgr","monsterMgr","bulletMgr","posMgr","effects","Node","players","type","Prefab","default","flag","onLoad","window","gm","offset","enableMapMove","currPlayer","instantiate","playerScript","getComponent","global","init","schedule","readTime","EM","on","COLLSI_FLAG","collsiFlag","PLAYER_TO_END","playerToEnd","countTime","time","unschedule","emit","RISE_WRITE_FLAG","ADD_SCORE","ADD_TIME","fsm","switchState","update","dt","playerPos","node","convertToWorldSpace","position","x","getDie","interval","size","getSize","left","convertToNodeSpace","v2","width","y","right","winSize","hCurrSpeed","fixOffset","pos","worldPos","onDestroy","off"],"mappings":"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","file":"gameMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        mapMgr:require(\"mapMgr\"),\r\n        propMgr:require(\"propMgr\"),\r\n        monsterMgr:require(\"monsterMgr\"),\r\n        bulletMgr:require(\"bulletMgr\"),\r\n        posMgr:require(\"posMgr\"),\r\n        effects:cc.Node,\r\n        players:\r\n        {\r\n            type:cc.Prefab,\r\n            default:[]   \r\n        },\r\n        flag:0,                         //人物移动到该点，地图移动，人物停止移动\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        window.gm=this;\r\n        this.offset=0;\r\n        this.enableMapMove=true;\r\n        this.currPlayer=cc.instantiate(this.players[0]);\r\n        this.playerScript=this.currPlayer.getComponent(\"player\");\r\n        global.init(1);\r\n        this.playerScript.init();\r\n        this.mapMgr.init(this.currPlayer);\r\n        this.monsterMgr.init();\r\n        this.propMgr.init();\r\n        this.posMgr.init();\r\n        //this.playerScript=this.currPlayer.getComponent(\"player\");\r\n        //this.node.addChild(this.currPlayer);\r\n\r\n        this.schedule(this.readTime,0.5);\r\n\r\n        EM.on(EM.type.COLLSI_FLAG,this.collsiFlag,this);\r\n        EM.on(EM.type.PLAYER_TO_END,this.playerToEnd,this);\r\n    },\r\n    playerToEnd(){\r\n        this.schedule(this.countTime,0.01);\r\n    },\r\n    countTime(){\r\n        if(global.time==0){\r\n            this.unschedule(this.countTime);\r\n            //next lv\r\n            EM.emit(EM.type.RISE_WRITE_FLAG);\r\n            return;\r\n        }\r\n        EM.emit(EM.type.ADD_SCORE,10);\r\n        EM.emit(EM.type.ADD_TIME,-1);\r\n    },\r\n    //读秒\r\n    readTime(){\r\n        if(global.time==0){\r\n            this.unschedule(this.readTime);\r\n            //next lv\r\n            this.playerScript.fsm.switchState(\"die\");\r\n            return;\r\n        }\r\n        EM.emit(EM.type.ADD_TIME,-1);\r\n    },\r\n    collsiFlag(){\r\n        //玩家碰到旗帜，地图禁止移动，取消读秒\r\n        //this.enableMapMove=false;\r\n        this.unschedule(this.readTime);\r\n    },\r\n\r\n    update (dt) {\r\n        let playerPos=this.node.convertToWorldSpace(this.currPlayer.position);\r\n        //地图的移动检测\r\n        if(this.enableMapMove){\r\n            if(playerPos.x>this.flag+this.offset&&!this.playerScript.getDie()){\r\n                let interval=playerPos.x-this.flag-this.offset;\r\n                this.node.x-=interval;\r\n                //cc.log(interval.toFixed(2)+\":\"+dt.toFixed(4));\r\n                if(--this.offset<0)this.offset=0;\r\n            } \r\n        }\r\n \r\n        //人物与地图左边界的检测\r\n        let size=this.playerScript.getSize();\r\n        let left=this.node.convertToNodeSpace(cc.v2(size.width/2,size.y));\r\n        let right=this.node.convertToNodeSpace(cc.v2(global.winSize.width-size.width/2,size.y));\r\n        if(right.x<size.x){\r\n            this.playerScript.hCurrSpeed=0;\r\n            this.playerScript.node.x=right.x;\r\n        }else if(left.x>size.x){\r\n            this.playerScript.hCurrSpeed=0;\r\n            this.playerScript.node.x=left.x;\r\n        }\r\n    },\r\n    fixOffset(pos){\r\n        let worldPos=this.node.convertToWorldSpace(pos);\r\n        if(worldPos.x>this.flag){\r\n            this.offset=worldPos.x-this.flag;\r\n        }\r\n    },\r\n    onDestroy(){\r\n        EM.off(EM.type.COLLSI_FLAG);\r\n        EM.off(EM.type.PLAYER_TO_END);\r\n    }\r\n});\r\n"]}