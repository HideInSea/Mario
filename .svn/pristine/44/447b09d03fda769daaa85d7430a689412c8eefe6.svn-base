{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\propMgr.js"],"names":["cc","Class","extends","Component","properties","mushroom","Prefab","flower","star","cirrus","ladder","story","aex","baby","spring","bubble","wheel","transition","roadCheck","init","propObjs","utils","deepClone","gm","mapMgr","propLayer","getObjects","resetObjects","onLoad","EM","on","type","CREATE_PROP","createProp","PAUSE_ACTOR","pauseActor","RESUME_ACTOR","resumeActor","children","node","i","length","getComponent","name","pause","resume","pos","propName","args","split","prop","script","ENUM","PROP_TYPE","COIN","MUSHROOM","global","getPlayerState","FORM_STATE","SMALL","LIFE","instantiate","STAR","CIRRUS","LADDER","STORY","AEX","BABY","SPRING","BUBBLE","WHEEL","TRANSITION","ROADCHECK","addChild","setPosition","apply","collsition","interactive","playerScript","collsiWithPushWall","wallBox","iteratorPropObjects","isObjectInScreen","obj","splice","tPos","toTiledPos","v2","x","y","tilePosToPos","collsitionWithBullet","mon","pBullets","bulletMgr","getPBullet","j","collsiWithPlayerBullet","collsitionWithMonster","monster","monsterMgr","getMonsters","one","collsiWithMon","update","dt","onDestroy","off"],"mappings":"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","file":"propMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        mushroom:cc.Prefab,\r\n        flower:cc.Prefab,\r\n        star:cc.Prefab,\r\n        cirrus:cc.Prefab,\r\n        ladder:cc.Prefab,\r\n        story:cc.Prefab,\r\n        aex:cc.Prefab,\r\n        baby:cc.Prefab,\r\n        spring:cc.Prefab,\r\n        bubble:cc.Prefab,\r\n        wheel:cc.Prefab,\r\n        transition:cc.Prefab,\r\n        roadCheck:cc.Prefab\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    init(){\r\n        this.propObjs=utils.deepClone(gm.mapMgr.propLayer.getObjects());\r\n    },\r\n    resetObjects(){\r\n        this.propObjs=utils.deepClone(gm.mapMgr.propLayer.getObjects());\r\n    },\r\n    onLoad () {\r\n        EM.on(EM.type.CREATE_PROP,this.createProp,this);\r\n\r\n        EM.on(EM.type.PAUSE_ACTOR,this.pauseActor,this);\r\n        EM.on(EM.type.RESUME_ACTOR,this.resumeActor,this);\r\n    },\r\n    pauseActor(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).pause();            \r\n        }\r\n    },\r\n    resumeActor(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).resume();            \r\n        }\r\n    },\r\n    createProp(pos,propName){\r\n        let args=propName.split(\"_\");\r\n        let prop=null;\r\n        let script=null;\r\n        switch(args[0]){\r\n            case ENUM.PROP_TYPE.COIN:return;\r\n            case ENUM.PROP_TYPE.MUSHROOM:\r\n                if(global.getPlayerState()===FORM_STATE.SMALL||args[1]===ENUM.PROP_TYPE.LIFE){\r\n                    prop=cc.instantiate(this.mushroom);\r\n                    script=prop.getComponent(\"mush\");\r\n                }else{\r\n                    prop=cc.instantiate(this.flower);\r\n                    script=prop.getComponent(\"flower\");\r\n                }\r\n            break;\r\n            case ENUM.PROP_TYPE.STAR:\r\n                prop=cc.instantiate(this.star);\r\n                script=prop.getComponent(\"star\");\r\n            break;\r\n            case ENUM.PROP_TYPE.CIRRUS:\r\n                prop=cc.instantiate(this.cirrus);\r\n                script=prop.getComponent(\"cirrus\");\r\n            break;\r\n            case ENUM.PROP_TYPE.LADDER:\r\n                prop=cc.instantiate(this.ladder);\r\n                script=prop.getComponent(\"ladder\");\r\n            break;\r\n            case ENUM.PROP_TYPE.STORY:\r\n                prop=cc.instantiate(this.story);\r\n                script=prop.getComponent(\"story\");\r\n            break;\r\n            case ENUM.PROP_TYPE.AEX:\r\n            prop=cc.instantiate(this.aex);\r\n            script=prop.getComponent(\"aex\");\r\n            break;\r\n            case ENUM.PROP_TYPE.BABY:\r\n            prop=cc.instantiate(this.baby);\r\n            script=prop.getComponent(\"baby\");\r\n            break;\r\n            case ENUM.PROP_TYPE.SPRING:\r\n            prop=cc.instantiate(this.spring);\r\n            script=prop.getComponent(\"spring\");\r\n            break;\r\n            case ENUM.PROP_TYPE.BUBBLE:\r\n            prop=cc.instantiate(this.bubble);\r\n            script=prop.getComponent(\"bubble\");\r\n            break;\r\n            case ENUM.PROP_TYPE.WHEEL:\r\n            prop=cc.instantiate(this.wheel);\r\n            script=prop.getComponent(\"wheel\");\r\n            break;\r\n            case ENUM.PROP_TYPE.TRANSITION:\r\n            prop=cc.instantiate(this.transition);\r\n            script=prop.getComponent(\"transition\");\r\n            break;\r\n            case ENUM.PROP_TYPE.ROADCHECK:\r\n            prop=cc.instantiate(this.roadCheck);\r\n            script=prop.getComponent(\"roadCheck\");\r\n            break;\r\n        }\r\n        this.node.addChild(prop);\r\n        prop.setPosition(pos);\r\n        script.init.apply(script,args);\r\n    },\r\n\r\n    collsition(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).interactive(gm.playerScript);            \r\n        }\r\n    },\r\n    collsiWithPushWall(wallBox){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).collsiWithPushWall(wallBox);            \r\n        }\r\n    },\r\n    //遍历怪物对象组，找出出现在当前屏幕中的对象\r\n    iteratorPropObjects(){\r\n        for(let i=0;i<this.propObjs.length;i++){\r\n            if(gm.mapMgr.isObjectInScreen(this.propObjs[i])){\r\n                let obj=this.propObjs.splice(i,1);\r\n                i--;\r\n                let tPos=gm.mapMgr.toTiledPos(cc.v2(obj[0].x,obj[0].y));\r\n                let pos=gm.mapMgr.tilePosToPos(tPos);\r\n                this.createProp(cc.v2(pos.x+20,pos.y),obj[0].name);\r\n            }\r\n        }\r\n    },\r\n    collsitionWithBullet(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            let mon=children[i].getComponent(children[i].name);\r\n            let pBullets=gm.bulletMgr.getPBullet();\r\n            for(let j=0;j<pBullets.length;j++){\r\n                mon.collsiWithPlayerBullet(pBullets[j].getComponent(pBullets[j].name));\r\n            }\r\n        }\r\n    },\r\n    collsitionWithMonster(){\r\n        let children=this.node.children;\r\n        let monster=gm.monsterMgr.getMonsters();\r\n        for(let i=0;i<children.length;i++){\r\n            let one=children[i].getComponent(children[i].name);\r\n            for(let j=0;j<monster.length;j++){\r\n                one.collsiWithMon(monster[j].getComponent(monster[j].name));\r\n            }      \r\n        }\r\n    },\r\n    update (dt) {\r\n\r\n        //道具与玩家的碰撞检测\r\n        this.collsition();\r\n\r\n        //遍历道具对象组\r\n        this.iteratorPropObjects();\r\n        \r\n        //与玩家子弹的碰撞检测\r\n        this.collsitionWithBullet();\r\n\r\n        //与怪物的碰撞检测\r\n        this.collsitionWithMonster();\r\n    },  \r\n    onDestroy(){\r\n        EM.off(EM.type.CREATE_PROP);\r\n\r\n        EM.off(EM.type.PAUSE_ACTOR);\r\n        EM.off(EM.type.RESUME_ACTOR);\r\n    }\r\n});\r\n"]}