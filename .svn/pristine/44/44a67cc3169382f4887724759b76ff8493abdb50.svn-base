{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\monster/assets\\script\\monster\\boss.js"],"names":["Actor","require","FSM","Walk","Fire","TopTurn","Die","cc","Class","extends","properties","init","node","zIndex","life","orignPos","position","dir","DIR","DIR_LEFT","enableCollsi","aex","arguments","fsm","animation","getComponent","Animation","addState","setDefaultState","moveLeft","moveBy","v2","runAction","repeatForever","sequence","reverse","schedule","jump","fire","vCurrSpeed","vCurrAcceleration","switchStateWithStack","getSize","size","getContentSize","rect","x","y","width","height","getFirePos","DIR_RIGHT","getDesFireY","Math","floor","random","turnLeft","scaleX","turnRight","onCollsiWithPBullet","bullet","die","switchState","interactive","actor","isDie","sizeOne","sizeTwo","actorCollsition","isFlashing","isInvincible","getFormState","FORM_STATE","SMALL","update","dt","isPause","enableMove","move","tile","getDownCollsiTile","type","TILE_TYPE","LAND","PIPE_H_ENTRY","WALL","PIPE_V_ENTRY","QUESTION","isOnLand","isOutScreen","removeFromParent"],"mappings":"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","file":"boss.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\monster","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar Actor=require(\"actor\");\r\nvar FSM=require(\"FSM\");\r\nvar {Walk,Fire,TopTurn,Die}=require(\"bossState\");\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    init(){\r\n        this.node.zIndex=100;\r\n        this.life=10;\r\n        this.orignPos=this.node.position;\r\n        this.dir=DIR.DIR_LEFT;\r\n        this.enableCollsi=true;\r\n        //是否允许使用斧子\r\n        this.aex=arguments[1];\r\n        this.fsm=new FSM();\r\n        this.animation=this.node.getComponent(cc.Animation);\r\n        this.fsm.addState(new Walk(this,\"walk\"));\r\n        this.fsm.addState(new Fire(this,\"fire\"));\r\n        this.fsm.addState(new TopTurn(this,\"updown\"));\r\n        this.fsm.addState(new Die(this,\"die\"));\r\n        this.fsm.setDefaultState(\"walk\");\r\n        //boss来回运动\r\n        let moveLeft=cc.moveBy(10,cc.v2(-360,0));\r\n        this.node.runAction(cc.repeatForever(cc.sequence(moveLeft,moveLeft.reverse())));\r\n\r\n        this.schedule(this.jump,4);\r\n\r\n        this.schedule(this.fire,3);\r\n    },\r\n    jump(){\r\n        this.vCurrSpeed=400;\r\n        this.vCurrAcceleration=-800;\r\n    },\r\n    fire(){\r\n        this.fsm.switchStateWithStack(\"fire\");\r\n    },\r\n    getSize(){\r\n        let size=this.node.getContentSize();\r\n        return cc.rect(this.node.x,this.node.y,size.width,size.height);\r\n    },\r\n    getFirePos(){\r\n        switch(this.dir){\r\n            case DIR.DIR_LEFT:return cc.v2(this.node.x-20,this.node.y+40);\r\n            case DIR.DIR_RIGHT:return cc.v2(this.node.x+20,this.node.y+40);\r\n        }\r\n    },\r\n    getDesFireY(){\r\n        return this.orignPos.y+Math.floor(Math.random()*4)*40;\r\n    },\r\n    turnLeft(){\r\n        this.node.scaleX=1;\r\n        this.dir=DIR.DIR_LEFT;\r\n    },\r\n    turnRight(){    \r\n        this.node.scaleX=-1;\r\n        this.dir=DIR.DIR_RIGHT;\r\n    },\r\n    onCollsiWithPBullet(bullet){\r\n        bullet.die();\r\n        if(this.life--<=0){\r\n            this.fsm.switchState(\"updown\");\r\n        }\r\n    },\r\n    interactive(actor){\r\n        if(actor.isDie||this.isDie)return;\r\n        let sizeOne=actor.getSize();\r\n        let sizeTwo=this.getSize();\r\n\r\n        if(sizeOne.x>sizeTwo.x&&this.dir===DIR.DIR_LEFT){\r\n            this.turnRight();\r\n        }else if(sizeOne.x<sizeTwo.x&&this.dir===DIR.DIR_RIGHT){\r\n            this.turnLeft();\r\n        }\r\n\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            //闪烁状态碰到怪物\r\n            if(!actor.isFlashing&&!actor.isInvincible){\r\n                if(actor.getFormState()!==FORM_STATE.SMALL){\r\n                    actor.fsm.switchStateWithStack(\"to_small\");\r\n                }else{\r\n                    actor.fsm.switchState(\"die\");\r\n                }\r\n            }\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    \r\n    // onLoad () {}\r\n\r\n    update (dt) {\r\n        if(this.isPause)return;\r\n\r\n        if(this.enableMove){\r\n            this.move(dt);\r\n        }\r\n\r\n        let tile=null;\r\n\r\n        if(this.enableCollsi){\r\n                    //脚底的碰撞检测\r\n        tile=this.getDownCollsiTile();\r\n        if(tile.type){\r\n            switch(tile.type){\r\n                case TILE_TYPE.LAND:\r\n                case TILE_TYPE.PIPE_H_ENTRY:\r\n                case TILE_TYPE.WALL:\r\n                case TILE_TYPE.PIPE_V_ENTRY:  \r\n                case TILE_TYPE.QUESTION:\r\n                this.node.y=this.orignPos.y;\r\n                this.vCurrAcceleration=0;\r\n                this.vCurrSpeed=0;\r\n                break;                    \r\n            }\r\n        }else{\r\n            if(this.isOnLand){\r\n                this.isOnLand=false;\r\n            }\r\n        }\r\n        }\r\n\r\n        if(this.isOutScreen()){\r\n            this.node.removeFromParent();            \r\n        }\r\n\r\n    }\r\n});\r\n"]}