{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\monster/assets\\script\\monster\\skyShoot.js"],"names":["Actor","require","cc","Class","extends","properties","init","count","isPause","animation","node","getComponent","Animation","isEnd","dir","DIR","DIR_LEFT","moveLeft","moveBy","v2","runAction","repeatForever","rightObj","gm","posMgr","posLayer","getObject","endPos","objectPosToMapPos","x","y","schedule","shootMon","EM","on","type","HEDGEHOG_DIE","unschedule","play","shoot","emit","CREATE_MONSTER","getShootPos","getSize","size","getContentSize","height","width","rect","turnRight","DIR_RIGHT","scaleY","turnLeft","update","dt","isOutScreen","removeFromParent","hCurrSpeed","currPlayer","playerScript","isLeftOrRight","move","worldPos","parent","convertToWorldSpace","position","localPos","convertToNodeSpace","interactive","actor","isDie","sizeOne","sizeTwo","actorCollsition","isFlashing","die","isInvincible","isUpOrDown","littleJump","getFormState","FORM_STATE","SMALL","fsm","switchStateWithStack","switchState","vCurrSpeed","vCurrAcceleration","hCurrAcceleration","enableCollsi","SCORE_EFFECT","onCollsiWithPBullet","bullet","pause","resume","onDestroy","off"],"mappings":"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","file":"skyShoot.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\monster","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar Actor=require(\"actor\");\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n    init(){\r\n        this.count=0;\r\n        this.isPause=false;\r\n        this.animation=this.node.getComponent(cc.Animation);\r\n        this.isEnd=false;\r\n        this.dir=DIR.DIR_LEFT;\r\n        let moveLeft=cc.moveBy(2,cc.v2(-40,0));\r\n        this.node.runAction(cc.repeatForever(moveLeft));\r\n        let rightObj=gm.posMgr.posLayer.getObject(\"shootEnd\");\r\n        this.endPos=gm.posMgr.objectPosToMapPos(cc.v2(rightObj.x,rightObj.y));\r\n\r\n        this.schedule(this.shootMon,3);\r\n\r\n        EM.on(EM.type.HEDGEHOG_DIE,function(){\r\n            if(this.count===3){\r\n                this.schedule(this.shootMon,3);\r\n            }\r\n            this.count--;\r\n        },this);\r\n    },\r\n    shootMon(){\r\n        if(this.count>=3){\r\n            this.unschedule(this.shootMon);\r\n            return;\r\n        }\r\n        this.animation.play(\"shoot\");\r\n    },\r\n    shoot(){\r\n        this.count++;\r\n        EM.emit(EM.type.CREATE_MONSTER,this.getShootPos(),\"hedgehog\");\r\n    },\r\n    getSize(){\r\n        let size=this.node.getContentSize();\r\n        let height=size.height-4;\r\n        let width=size.width-4;\r\n        return cc.rect(this.node.x,this.node.y,width,height);\r\n    },\r\n    getShootPos(){\r\n        let size=this.node.getContentSize();\r\n        return cc.v2(this.node.x,this.node.y+size.height);\r\n    },\r\n    turnRight(){\r\n        this.dir=DIR.DIR_RIGHT;\r\n        this.node.scaleY=-1;\r\n    },\r\n    turnLeft(){\r\n        this.dir=DIR.DIR_LEFT;\r\n        this.node.scaleY=1;\r\n    },\r\n    update (dt) {\r\n        if(this.isPause||this.isEnd)return;\r\n\r\n        if(this.isOutScreen()){\r\n            this.node.removeFromParent();\r\n            return;\r\n        }\r\n\r\n        //是否到达终点\r\n        if(this.node.x>this.endPos.x){\r\n            this.unschedule(this.shootMon);\r\n            this.hCurrSpeed=0;\r\n            this.isEnd=true;\r\n            return;\r\n        }\r\n\r\n        //改变方向\r\n        if(this.node.x>gm.currPlayer.x&&this.dir===DIR.DIR_RIGHT){\r\n            this.turnLeft();\r\n        }else if(this.node.x<gm.currPlayer.x&&this.dir===DIR.DIR_LEFT){\r\n            this.turnRight();\r\n        }\r\n\r\n        if(gm.playerScript.isLeftOrRight()){\r\n            this.hCurrSpeed=0;\r\n        }else{\r\n            this.hCurrSpeed=350;\r\n        }\r\n\r\n\r\n        this.move(dt);\r\n\r\n\r\n        //与左边界的碰撞检测  //与右边界的碰撞检测\r\n        let worldPos=this.node.parent.convertToWorldSpace(this.node.position);\r\n        let localPos=this.node.parent.convertToNodeSpace(cc.v2(0,0));\r\n        if(worldPos.x<40){\r\n            this.node.x=localPos.x+40;\r\n        }else if(worldPos.x>600){\r\n            this.node.x=localPos.x+600;\r\n        }\r\n      \r\n\r\n    },\r\n    interactive(actor){\r\n        if(this.isDie||actor.isDie)return;\r\n\r\n        let sizeOne=actor.getSize();\r\n        let sizeTwo=this.getSize();\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            //闪烁状态碰到怪物\r\n            if(actor.isFlashing){\r\n                this.die();\r\n            }\r\n            //无敌状态碰到怪物\r\n            else if(actor.isInvincible){\r\n                //踩到蘑菇\r\n                if(sizeOne.y>=sizeTwo.y+sizeTwo.height/2&&!actor.isUpOrDown()){\r\n                    actor.littleJump();\r\n                    this.die();\r\n                }\r\n            }\r\n            //普通状态碰到蘑菇\r\n            else{\r\n                //踩到蘑菇\r\n                if(sizeOne.y>=sizeTwo.y+sizeTwo.height/2){\r\n                    actor.littleJump();\r\n                    this.die();\r\n                }else if(actor.getFormState()!==FORM_STATE.SMALL){\r\n                    actor.fsm.switchStateWithStack(\"to_small\");\r\n                }else{\r\n                    actor.fsm.switchState(\"die\");\r\n                }\r\n            }\r\n        }\r\n    },\r\n    die(){\r\n        this.isDie=true;\r\n        this.node.scaleY=-1;\r\n        this.node.y+=40;\r\n        this.vCurrSpeed=300;\r\n        this.vCurrAcceleration=-1400;\r\n        this.hCurrSpeed=0;\r\n        this.hCurrAcceleration=0;\r\n        this.enableCollsi=false;\r\n        this.animation.play(\"die\");\r\n        EM.emit(EM.type.SCORE_EFFECT,cc.v2(this.node.x,this.node.y+80),200);\r\n    },\r\n    onCollsiWithPBullet(bullet){\r\n        bullet.die();\r\n        this.die();\r\n    },\r\n    pause(){\r\n        this.isPause=true;\r\n        this.animation.pause();\r\n    },\r\n    resume(){\r\n        this.isPause=false;\r\n        this.animation.resume();\r\n    },\r\n    onDestroy(){\r\n        EM.off(EM.type.HEDGEHOG_DIE);\r\n    }\r\n});\r\n"]}