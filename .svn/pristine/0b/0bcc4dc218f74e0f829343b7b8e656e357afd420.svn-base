{"version":3,"sources":["posMgr.js"],"names":["require","MoveCmd","cc","Class","extends","Component","properties","init","currMapFixed","global","isGameOver","posLayer","gm","mapMgr","posObjects","getObjects","startObj","getObject","endObj","startPos","objectPosToMapPos","v2","x","y","endPos","currPlayer","setPosition","config","mapConfig","startType","getRound","playerScript","enableInput","aiCtrl","addCmd","macro","KEY","d","mapFixeds","i","length","name","ENUM","POSITION_TYPE","MAP_FIXED","push","splice","update","dt","active","EM","emit","type","PLAYER_TO_END","mapFixed","setMapToPos","pos","node","paseTile","tilePosToPos","toTiledPos","hPipeEntry","args","split","desObj","mapPos","desPos","desMapPos","parseInt","moveLeft","moveTo","PIPE_POS_TYPE","LAND","runAction","sequence","callFunc","landCallBack","AIR","airCallBack","vPipeEntry","moveDown","moveBy","ROUND","selectRound","log","target","data","fadeOut","fadeIn","delay","delayTime","fsm","switchState","isPause","enableMapMove","worldPos","convertToWorldSpace","removeCurrMapFixed"],"mappings":"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","file":"posMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar {MoveCmd}=require(\"aiCtrl\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    init(){\r\n        this.currMapFixed=0;\r\n        global.isGameOver=false;\r\n        this.posLayer=gm.mapMgr.posLayer;\r\n        this.posObjects=this.posLayer.getObjects();\r\n        let startObj=this.posLayer.getObject(\"start\");\r\n        let endObj=this.posLayer.getObject(\"end\");\r\n        let startPos=this.objectPosToMapPos(cc.v2(startObj.x,startObj.y));\r\n        let endPos=null;\r\n        if(endObj){\r\n            endPos=this.objectPosToMapPos(cc.v2(endObj.x,endObj.y));\r\n            this.endPos=cc.v2(endPos.x+20,endPos.y);\r\n        }\r\n        this.startPos=cc.v2(startPos.x+20,startPos.y);\r\n\r\n        gm.currPlayer.setPosition(this.startPos);\r\n        if(config.mapConfig.startType[global.getRound()]){\r\n            gm.playerScript.enableInput=false;\r\n            gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.d,\"keydown\"));\r\n        }\r\n        //地图固定点\r\n        this.mapFixeds=[];\r\n        for(let i=0;i<this.posObjects.length;i++){\r\n            if(this.posObjects[i].name===ENUM.POSITION_TYPE.MAP_FIXED){\r\n                this.mapFixeds.push(this.posObjects.splice(i,1)[0]);\r\n                i--;\r\n            }\r\n        }\r\n    },\r\n    update (dt) {\r\n        //检测玩家是否走到终点\r\n        if(this.endPos&&gm.currPlayer.x>=this.endPos.x&&gm.currPlayer.x<=this.endPos.x+20&&!global.isGameOver){\r\n            gm.currPlayer.active=false;\r\n            global.isGameOver=true;\r\n            EM.emit(EM.type.PLAYER_TO_END);\r\n        }\r\n\r\n        //检测地图固定点\r\n        this.mapFixed();\r\n    },\r\n    setMapToPos(pos){\r\n        gm.node.setPosition(pos);\r\n        gm.mapMgr.paseTile(true);\r\n    },\r\n    objectPosToMapPos(pos){\r\n        return gm.mapMgr.tilePosToPos(gm.mapMgr.toTiledPos(pos));\r\n    },\r\n    hPipeEntry(type,pos){\r\n        let args=type.split(\"_\");\r\n        let desObj=this.posLayer.getObject(\"pipeEnd_\"+args[2]);\r\n        let mapPos=this.objectPosToMapPos(cc.v2(desObj.x,desObj.y));\r\n        //let screenPos=gm.mapMgr.mapPosToScreenPos(mapPos);\r\n        let desPos=cc.v2(mapPos.x+40,mapPos.y);\r\n        let desMapPos=cc.v2(-desPos.x+40*parseInt(args[3])-320,gm.node.y);\r\n        let moveLeft=cc.moveTo(1,pos);\r\n\r\n        switch(args[1]){\r\n            case ENUM.PIPE_POS_TYPE.LAND:\r\n                gm.currPlayer.runAction(cc.sequence(moveLeft,cc.callFunc(this.landCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n            case ENUM.PIPE_POS_TYPE.AIR:\r\n                gm.currPlayer.runAction(cc.sequence(moveLeft,cc.callFunc(this.airCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n        }\r\n    },\r\n    vPipeEntry(type,pos){\r\n        let args=type.split(\"_\");\r\n        let moveDown=cc.moveBy(1,cc.v2(0,-80));\r\n\r\n        if(args[0]===ENUM.POSITION_TYPE.ROUND){\r\n            gm.currPlayer.runAction(cc.sequence(moveDown,cc.callFunc(this.selectRound,this)));\r\n            return;\r\n        }\r\n\r\n        let desObj=this.posLayer.getObject(\"pipeEnd_\"+args[2]);\r\n        let mapPos=this.objectPosToMapPos(cc.v2(desObj.x,desObj.y));\r\n        //let screenPos=gm.mapMgr.mapPosToScreenPos(mapPos);\r\n        let desPos=cc.v2(mapPos.x+40,mapPos.y);\r\n        let desMapPos=cc.v2(-desPos.x+40*parseInt(args[3])-320,gm.node.y);\r\n\r\n        switch(args[1]){\r\n            case ENUM.PIPE_POS_TYPE.LAND:\r\n                gm.currPlayer.runAction(cc.sequence(moveDown,cc.callFunc(this.landCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n            case ENUM.PIPE_POS_TYPE.AIR:\r\n                gm.currPlayer.runAction(cc.sequence(moveDown,cc.callFunc(this.airCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n        }\r\n    },  \r\n    selectRound(){\r\n        cc.log(\"next\");\r\n    },\r\n    landCallBack(target,data){\r\n        let fadeOut=cc.fadeOut(0.05);\r\n        let fadeIn=cc.fadeIn(0.05);\r\n        let delay=cc.delayTime(0.2);\r\n        gm.node.runAction(cc.sequence(fadeOut,cc.callFunc(function(target,data){\r\n            gm.currPlayer.setPosition(cc.v2(data.desPos.x,data.desPos.y));\r\n            this.setMapToPos(data.desMapPos);\r\n            gm.playerScript.fsm.switchState(\"stand\");\r\n        },this,data),delay,fadeIn,cc.callFunc(function(){\r\n            gm.currPlayer.runAction(cc.sequence(cc.moveBy(1,cc.v2(0,80)),cc.callFunc(function(){\r\n                gm.playerScript.isPause=false;\r\n                gm.playerScript.enableInput=true;\r\n                gm.enableMapMove=true;\r\n            },this)));\r\n        },this)));\r\n    },\r\n    airCallBack(target,data){\r\n        let fadeOut=cc.fadeOut(0.05);\r\n        let fadeIn=cc.fadeIn(0.05);\r\n        let delay=cc.delayTime(0.5);\r\n        gm.node.runAction(cc.sequence(fadeOut,cc.callFunc(function(target,data){\r\n            gm.currPlayer.setPosition(data.desPos);\r\n            this.setMapToPos(data.desMapPos);\r\n            gm.playerScript.fsm.switchState(\"stand\");\r\n        },this,data),delay,fadeIn,cc.callFunc(function(){\r\n            gm.playerScript.isPause=false;\r\n            gm.playerScript.enableInput=true;\r\n            gm.enableMapMove=true;\r\n        },this)));\r\n    },\r\n    mapFixed(){\r\n        if(!gm.enableMapMove)return;\r\n        for(let i=0;i<this.mapFixeds.length;i++){\r\n            //cc.log(this.mapFixeds[i]);\r\n            let pos=this.objectPosToMapPos(cc.v2(this.mapFixeds[i].x,this.mapFixeds[i].y));\r\n            let worldPos=gm.node.convertToWorldSpace(cc.v2(pos.x+39,pos.y));\r\n            if(worldPos.x>0&&worldPos.x<=640){\r\n                this.currMapFixed=i;\r\n                gm.node.x+=640-worldPos.x-1;\r\n                gm.enableMapMove=false;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    removeCurrMapFixed(){\r\n        this.mapFixeds.splice(this.currMapFixed,1);\r\n    }\r\n});\r\n"]}