{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\monsterMgr.js"],"names":["cc","Class","extends","Component","properties","mushroom","Prefab","duck","mflower","fire","fireBall","boss","init","monsterObjs","gm","mapMgr","monsterLayer","getObjects","currBoss","isBossDie","onLoad","EM","on","type","PAUSE_ACTOR","pauseActor","RESUME_ACTOR","resumeActor","REMOVE_ALL_MON","node","removeAllChildren","CREATE_MONSTER","createMonster","children","i","length","getComponent","name","pause","resume","pos","monName","args","split","mon","script","ENUM","MON_TYPE","MUSHROOM","instantiate","DUCK","FLOWER","v2","x","y","FIRE","FIRE_BALL","BOSS","addChild","setPosition","apply","update","dt","collsitionWithPlayer","collsitionWithMonster","collsitionWithBullet","iteratorMonsterObjects","onDestroy","off","collsiWithPushWall","wallBox","interactive","playerScript","one","j","collsiWithMon","pBullets","bulletMgr","getPBullet","collsiWithPlayerBullet","isObjectInScreen","obj","splice","tPos","toTiledPos","tilePosToPos"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,kBAASL,GAAGM,MAhBJ;AAiBRC,cAAKP,GAAGM,MAjBA;AAkBRE,iBAAQR,GAAGM,MAlBH;AAmBRG,cAAKT,GAAGM,MAnBA;AAoBRI,kBAASV,GAAGM,MApBJ;AAqBRK,cAAKX,GAAGM;AArBA,KAHP;;AA2BL;;AAEA;;AAEAM,QA/BK,kBA+BC;AACF,aAAKC,WAAL,GAAiBC,GAAGC,MAAH,CAAUC,YAAV,CAAuBC,UAAvB,EAAjB;AACA,aAAKC,QAAL,GAAc,IAAd;AACA,aAAKC,SAAL,GAAe,KAAf;AACH,KAnCI;AAoCLC,UApCK,oBAoCK;AACNC,WAAGC,EAAH,CAAMD,GAAGE,IAAH,CAAQC,WAAd,EAA0B,KAAKC,UAA/B,EAA0C,IAA1C;AACAJ,WAAGC,EAAH,CAAMD,GAAGE,IAAH,CAAQG,YAAd,EAA2B,KAAKC,WAAhC,EAA4C,IAA5C;AACAN,WAAGC,EAAH,CAAMD,GAAGE,IAAH,CAAQK,cAAd,EAA6B,YAAU;AACnC,iBAAKC,IAAL,CAAUC,iBAAV;AACH,SAFD,EAEE,IAFF;AAGAT,WAAGC,EAAH,CAAMD,GAAGE,IAAH,CAAQQ,cAAd,EAA6B,KAAKC,aAAlC,EAAgD,IAAhD;AACH,KA3CI;AA6CLP,cA7CK,wBA6CO;AACR,YAAIQ,WAAS,KAAKJ,IAAL,CAAUI,QAAvB;AACA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAED,SAASE,MAAvB,EAA8BD,GAA9B,EAAkC;AAC9BD,qBAASC,CAAT,EAAYE,YAAZ,CAAyBH,SAASC,CAAT,EAAYG,IAArC,EAA2CC,KAA3C;AACH;AACJ,KAlDI;AAmDLX,eAnDK,yBAmDQ;AACT,YAAIM,WAAS,KAAKJ,IAAL,CAAUI,QAAvB;AACA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAED,SAASE,MAAvB,EAA8BD,GAA9B,EAAkC;AAC9BD,qBAASC,CAAT,EAAYE,YAAZ,CAAyBH,SAASC,CAAT,EAAYG,IAArC,EAA2CE,MAA3C;AACH;AACJ,KAxDI;AAyDLP,iBAzDK,yBAyDSQ,GAzDT,EAyDaC,OAzDb,EAyDqB;AACtB,YAAIC,OAAKD,QAAQE,KAAR,CAAc,GAAd,CAAT;AACA,YAAIC,MAAI,IAAR;AACA,YAAIC,SAAO,IAAX;AACA,gBAAOH,KAAK,CAAL,CAAP;AACI,iBAAKI,KAAKC,QAAL,CAAcC,QAAnB;AACIJ,sBAAI5C,GAAGiD,WAAH,CAAe,KAAK5C,QAApB,CAAJ;AACAwC,yBAAOD,IAAIR,YAAJ,CAAiBQ,IAAIP,IAArB,CAAP;AACJ;AACA,iBAAKS,KAAKC,QAAL,CAAcG,IAAnB;AACIN,sBAAI5C,GAAGiD,WAAH,CAAe,KAAK1C,IAApB,CAAJ;AACAsC,yBAAOD,IAAIR,YAAJ,CAAiBQ,IAAIP,IAArB,CAAP;AACJ;AACA,iBAAKS,KAAKC,QAAL,CAAcI,MAAnB;AACIP,sBAAI5C,GAAGiD,WAAH,CAAe,KAAKzC,OAApB,CAAJ;AACAqC,yBAAOD,IAAIR,YAAJ,CAAiBQ,IAAIP,IAArB,CAAP;AACAG,sBAAIxC,GAAGoD,EAAH,CAAMZ,IAAIa,CAAJ,GAAM,EAAZ,EAAeb,IAAIc,CAAnB,CAAJ;AACJ;AACA,iBAAKR,KAAKC,QAAL,CAAcQ,IAAnB;AACIX,sBAAI5C,GAAGiD,WAAH,CAAe,KAAKxC,IAApB,CAAJ;AACAoC,yBAAOD,IAAIR,YAAJ,CAAiBQ,IAAIP,IAArB,CAAP;AACJ;AACA,iBAAKS,KAAKC,QAAL,CAAcS,SAAnB;AACIZ,sBAAI5C,GAAGiD,WAAH,CAAe,KAAKvC,QAApB,CAAJ;AACAmC,yBAAOD,IAAIR,YAAJ,CAAiBQ,IAAIP,IAArB,CAAP;AACAG,sBAAIxC,GAAGoD,EAAH,CAAMZ,IAAIa,CAAV,EAAYb,IAAIc,CAAJ,GAAM,EAAlB,CAAJ;AACJ;AACA,iBAAKR,KAAKC,QAAL,CAAcU,IAAnB;AACIb,sBAAI5C,GAAGiD,WAAH,CAAe,KAAKtC,IAApB,CAAJ;AACAkC,yBAAOD,IAAIR,YAAJ,CAAiBQ,IAAIP,IAArB,CAAP;AACA,qBAAKnB,QAAL,GAAc2B,MAAd;AACJ;AA3BJ;AA6BA,aAAKhB,IAAL,CAAU6B,QAAV,CAAmBd,GAAnB;AACAA,YAAIe,WAAJ,CAAgBnB,GAAhB;AACAK,eAAOjC,IAAP,CAAYgD,KAAZ,CAAkBf,MAAlB,EAAyBH,IAAzB;AACH,KA7FI;AA8FLmB,UA9FK,kBA8FGC,EA9FH,EA8FO;AACR;AACA,aAAKC,oBAAL;;AAEA;AACA,aAAKC,qBAAL;;AAEA;AACA,aAAKC,oBAAL;;AAEA;AACA,aAAKC,sBAAL;AACH,KA1GI;AA2GLC,aA3GK,uBA2GM;;AAEP9C,WAAG+C,GAAH,CAAO/C,GAAGE,IAAH,CAAQC,WAAf;AACAH,WAAG+C,GAAH,CAAO/C,GAAGE,IAAH,CAAQG,YAAf;AACAL,WAAG+C,GAAH,CAAO/C,GAAGE,IAAH,CAAQK,cAAf;AACAP,WAAG+C,GAAH,CAAO/C,GAAGE,IAAH,CAAQQ,cAAf;AACH,KAjHI;AAkHLsC,sBAlHK,8BAkHcC,OAlHd,EAkHsB;AACvB,YAAIrC,WAAS,KAAKJ,IAAL,CAAUI,QAAvB;AACA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAED,SAASE,MAAvB,EAA8BD,GAA9B,EAAkC;AAC9BD,qBAASC,CAAT,EAAYE,YAAZ,CAAyBH,SAASC,CAAT,EAAYG,IAArC,EAA2CgC,kBAA3C,CAA8DC,OAA9D;AACH;AACJ,KAvHI;AAwHLP,wBAxHK,kCAwHiB;AAClB,YAAI9B,WAAS,KAAKJ,IAAL,CAAUI,QAAvB;AACA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAED,SAASE,MAAvB,EAA8BD,GAA9B,EAAkC;AAC9BD,qBAASC,CAAT,EAAYE,YAAZ,CAAyBH,SAASC,CAAT,EAAYG,IAArC,EAA2CkC,WAA3C,CAAuDzD,GAAG0D,YAA1D;AACH;AACJ,KA7HI;AA8HLR,yBA9HK,mCA8HkB;AACnB,YAAI/B,WAAS,KAAKJ,IAAL,CAAUI,QAAvB;AACA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAED,SAASE,MAAvB,EAA8BD,GAA9B,EAAkC;AAC9B,gBAAIuC,MAAIxC,SAASC,CAAT,EAAYE,YAAZ,CAAyBH,SAASC,CAAT,EAAYG,IAArC,CAAR;AACA,iBAAI,IAAIqC,IAAE,CAAV,EAAYA,IAAEzC,SAASE,MAAvB,EAA8BuC,GAA9B,EAAkC;AAC9B,oBAAGxC,KAAGwC,CAAN,EAAQ;AACRD,oBAAIE,aAAJ,CAAkB1C,SAASyC,CAAT,EAAYtC,YAAZ,CAAyBH,SAASyC,CAAT,EAAYrC,IAArC,CAAlB;AACH;AACJ;AACJ,KAvII;AAwIL4B,wBAxIK,kCAwIiB;AAClB,YAAIhC,WAAS,KAAKJ,IAAL,CAAUI,QAAvB;AACA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAED,SAASE,MAAvB,EAA8BD,GAA9B,EAAkC;AAC9B,gBAAIU,MAAIX,SAASC,CAAT,EAAYE,YAAZ,CAAyBH,SAASC,CAAT,EAAYG,IAArC,CAAR;AACA,gBAAIuC,WAAS9D,GAAG+D,SAAH,CAAaC,UAAb,EAAb;AACA,iBAAI,IAAIJ,IAAE,CAAV,EAAYA,IAAEE,SAASzC,MAAvB,EAA8BuC,GAA9B,EAAkC;AAC9B9B,oBAAImC,sBAAJ,CAA2BH,SAASF,CAAT,EAAYtC,YAAZ,CAAyBwC,SAASF,CAAT,EAAYrC,IAArC,CAA3B;AACH;AACJ;AACJ,KAjJI;;AAkJL;AACA6B,0BAnJK,oCAmJmB;AACpB,aAAI,IAAIhC,IAAE,CAAV,EAAYA,IAAE,KAAKrB,WAAL,CAAiBsB,MAA/B,EAAsCD,GAAtC,EAA0C;AACtC,gBAAGpB,GAAGC,MAAH,CAAUiE,gBAAV,CAA2B,KAAKnE,WAAL,CAAiBqB,CAAjB,CAA3B,CAAH,EAAmD;AAC/C,oBAAI+C,MAAI,KAAKpE,WAAL,CAAiBqE,MAAjB,CAAwBhD,CAAxB,EAA0B,CAA1B,CAAR;AACAA;AACA,oBAAIiD,OAAKrE,GAAGC,MAAH,CAAUqE,UAAV,CAAqBpF,GAAGoD,EAAH,CAAM6B,IAAI,CAAJ,EAAO5B,CAAb,EAAe4B,IAAI,CAAJ,EAAO3B,CAAtB,CAArB,CAAT;AACA,oBAAId,MAAI1B,GAAGC,MAAH,CAAUsE,YAAV,CAAuBF,IAAvB,CAAR;AACA,qBAAKnD,aAAL,CAAmBhC,GAAGoD,EAAH,CAAMZ,IAAIa,CAAJ,GAAM,EAAZ,EAAeb,IAAIc,CAAnB,CAAnB,EAAyC2B,IAAI,CAAJ,EAAO5C,IAAhD;AACH;AACJ;AACJ;AA7JI,CAAT","file":"monsterMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        mushroom:cc.Prefab,\r\n        duck:cc.Prefab,\r\n        mflower:cc.Prefab,\r\n        fire:cc.Prefab,\r\n        fireBall:cc.Prefab,\r\n        boss:cc.Prefab\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    init(){\r\n        this.monsterObjs=gm.mapMgr.monsterLayer.getObjects();\r\n        this.currBoss=null;\r\n        this.isBossDie=false;\r\n    },\r\n    onLoad () {\r\n        EM.on(EM.type.PAUSE_ACTOR,this.pauseActor,this);\r\n        EM.on(EM.type.RESUME_ACTOR,this.resumeActor,this);\r\n        EM.on(EM.type.REMOVE_ALL_MON,function(){\r\n            this.node.removeAllChildren();\r\n        },this);\r\n        EM.on(EM.type.CREATE_MONSTER,this.createMonster,this);\r\n    },\r\n\r\n    pauseActor(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).pause();            \r\n        }\r\n    },\r\n    resumeActor(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).resume();            \r\n        }\r\n    },\r\n    createMonster(pos,monName){\r\n        let args=monName.split(\"_\");\r\n        let mon=null;\r\n        let script=null;\r\n        switch(args[0]){\r\n            case ENUM.MON_TYPE.MUSHROOM:\r\n                mon=cc.instantiate(this.mushroom);\r\n                script=mon.getComponent(mon.name);\r\n            break;\r\n            case ENUM.MON_TYPE.DUCK:\r\n                mon=cc.instantiate(this.duck);\r\n                script=mon.getComponent(mon.name);\r\n            break;\r\n            case ENUM.MON_TYPE.FLOWER:\r\n                mon=cc.instantiate(this.mflower);\r\n                script=mon.getComponent(mon.name);\r\n                pos=cc.v2(pos.x+20,pos.y);\r\n            break;\r\n            case ENUM.MON_TYPE.FIRE:\r\n                mon=cc.instantiate(this.fire);\r\n                script=mon.getComponent(mon.name);\r\n            break;\r\n            case ENUM.MON_TYPE.FIRE_BALL:\r\n                mon=cc.instantiate(this.fireBall);\r\n                script=mon.getComponent(mon.name);\r\n                pos=cc.v2(pos.x,pos.y+20);\r\n            break;\r\n            case ENUM.MON_TYPE.BOSS:\r\n                mon=cc.instantiate(this.boss);\r\n                script=mon.getComponent(mon.name);\r\n                this.currBoss=script;\r\n            break;\r\n        }\r\n        this.node.addChild(mon);\r\n        mon.setPosition(pos);\r\n        script.init.apply(script,args);\r\n    },\r\n    update (dt) {\r\n        //怪物与玩家的碰撞检测\r\n        this.collsitionWithPlayer();\r\n\r\n        //怪物与怪物的碰撞检测\r\n        this.collsitionWithMonster();\r\n\r\n        //与玩家子弹的碰撞检测\r\n        this.collsitionWithBullet();\r\n\r\n        //遍历怪物对象组\r\n        this.iteratorMonsterObjects();\r\n    },  \r\n    onDestroy(){\r\n\r\n        EM.off(EM.type.PAUSE_ACTOR);\r\n        EM.off(EM.type.RESUME_ACTOR);\r\n        EM.off(EM.type.REMOVE_ALL_MON);\r\n        EM.off(EM.type.CREATE_MONSTER);\r\n    },\r\n    collsiWithPushWall(wallBox){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).collsiWithPushWall(wallBox);            \r\n        }\r\n    },\r\n    collsitionWithPlayer(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).interactive(gm.playerScript);            \r\n        }\r\n    },\r\n    collsitionWithMonster(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            let one=children[i].getComponent(children[i].name);\r\n            for(let j=0;j<children.length;j++){\r\n                if(i==j)continue;\r\n                one.collsiWithMon(children[j].getComponent(children[j].name));\r\n            }      \r\n        }\r\n    },\r\n    collsitionWithBullet(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            let mon=children[i].getComponent(children[i].name);\r\n            let pBullets=gm.bulletMgr.getPBullet();\r\n            for(let j=0;j<pBullets.length;j++){\r\n                mon.collsiWithPlayerBullet(pBullets[j].getComponent(pBullets[j].name));\r\n            }\r\n        }\r\n    },\r\n    //遍历怪物对象组，找出出现在当前屏幕中的对象\r\n    iteratorMonsterObjects(){\r\n        for(let i=0;i<this.monsterObjs.length;i++){\r\n            if(gm.mapMgr.isObjectInScreen(this.monsterObjs[i])){\r\n                let obj=this.monsterObjs.splice(i,1);\r\n                i--;\r\n                let tPos=gm.mapMgr.toTiledPos(cc.v2(obj[0].x,obj[0].y));\r\n                let pos=gm.mapMgr.tilePosToPos(tPos);\r\n                this.createMonster(cc.v2(pos.x+20,pos.y),obj[0].name);\r\n            }\r\n        }\r\n    }\r\n});\r\n"]}