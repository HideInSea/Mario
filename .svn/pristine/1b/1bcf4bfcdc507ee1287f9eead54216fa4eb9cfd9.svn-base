{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\prop/assets\\script\\prop\\cirrus.js"],"names":["Actor","require","MoveCmd","cc","Class","extends","properties","head","Prefab","body","init","isStart","isEnd","isAiCtrl","actorType","arguments","desObj","gm","posMgr","posLayer","getObject","mapPos","objectPosToMapPos","v2","x","y","desPos","desMapPos","parseInt","node","length","instantiate","addChild","bodys","push","i","moveUp","moveBy","runAction","update","dt","isOutScreen","removeFromParent","reBorth","value","getSize","width","height","rect","interactive","actor","isDie","sizeOne","sizeTwo","actorCollsition","isOnCirrus","playerScript","aiCtrl","addCmd","macro","KEY","w","stopAllActions","fadeOut","fadeIn","delay","delayTime","sequence","callFunc","setMapToPos","setPosition","setTimeout","enableInput","releaseAllKey","isTouchLand","isLeftOrRight","turnLeft","turnRight","fsm","switchState"],"mappings":"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","file":"cirrus.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\prop","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar Actor=require(\"actor\");\r\nvar {MoveCmd}=require(\"aiCtrl\");\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        head:cc.Prefab,\r\n        body:cc.Prefab\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n    \r\n    init(){\r\n        this.isStart=true;\r\n        this.isEnd=false;\r\n        this.isAiCtrl=false;\r\n\r\n        this.actorType=arguments[0];\r\n\r\n        let desObj=gm.posMgr.posLayer.getObject(\"cirrusEnd_\"+arguments[1]);\r\n        let mapPos=gm.posMgr.objectPosToMapPos(cc.v2(desObj.x,desObj.y));\r\n        //let screenPos=gm.mapMgr.mapPosToScreenPos(mapPos);\r\n        this.desPos=cc.v2(mapPos.x+20,mapPos.y-80);\r\n        this.desMapPos=cc.v2(-mapPos.x+40*parseInt(arguments[2])-320,gm.node.y);\r\n\r\n\r\n        this.length=6;\r\n        this.head=cc.instantiate(this.head);\r\n        this.head.y=0;\r\n        this.node.addChild(this.head);\r\n        this.bodys=[];\r\n        this.bodys.push(this.head);\r\n        for(let i=0;i<this.length;i++){\r\n            let body=cc.instantiate(this.body);\r\n            this.bodys.push(body);\r\n            this.node.addChild(body);\r\n        }\r\n\r\n        let moveUp=cc.moveBy(4,cc.v2(0,this.length*40));\r\n        this.head.runAction(moveUp);\r\n    },\r\n    update (dt) {\r\n        for(let i=1;i<this.bodys.length;i++){\r\n            if(this.bodys[i-1].y>38)this.bodys[i].y=this.bodys[i-1].y-39;\r\n            else break;\r\n        }\r\n\r\n        if(this.isOutScreen()){\r\n            this.node.removeFromParent();\r\n        }\r\n    },\r\n    reBorth(){\r\n        for(let value of this.bodys){\r\n            value.y=0;\r\n        }\r\n        let moveUp=cc.moveBy(3,cc.v2(0,this.length*40));\r\n        this.head.runAction(moveUp);\r\n    },\r\n    getSize(){\r\n        let x=this.node.x;\r\n        let y=this.node.y;\r\n        let width=10;\r\n        let height=this.head.y+40;\r\n        return cc.rect(x,y,width,height);\r\n    },\r\n    interactive(actor){\r\n        if(actor.isDie)return;\r\n        let sizeOne=actor.getSize();\r\n        let sizeTwo=this.getSize();\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            if(actor.isOnCirrus){\r\n                if(this.isStart){\r\n                    if(sizeOne.y>sizeTwo.y+this.length*40&&this.isAiCtrl){\r\n                        gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.w,\"keyup\")); \r\n                        this.node.stopAllActions();\r\n                        this.isStart=false;\r\n\r\n                        let fadeOut=cc.fadeOut(0.05);\r\n                        let fadeIn=cc.fadeIn(0.05);\r\n                        let delay=cc.delayTime(0.2);\r\n                        gm.node.runAction(cc.sequence(fadeOut,cc.callFunc(function(){\r\n                            gm.posMgr.setMapToPos(this.desMapPos);\r\n                            gm.playerScript.node.setPosition(this.desPos);\r\n                            this.node.setPosition(this.desPos);\r\n                        },this),delay,fadeIn,cc.callFunc(function(){\r\n                            this.reBorth();\r\n                            setTimeout(function(){\r\n                                gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.w,\"keydown\")); \r\n                            },2000);\r\n                            this.isEnd=true;\r\n                        },this)));        \r\n\r\n                    }else if(sizeOne.y>sizeTwo.y+4*40&&!this.isAiCtrl){\r\n                        this.isAiCtrl=true;\r\n                        gm.playerScript.enableInput=false;\r\n                        gm.playerScript.releaseAllKey();          \r\n                        gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.w,\"keydown\"));  \r\n                    }\r\n                }else if(this.isEnd){\r\n                        if(sizeOne.y>sizeTwo.y+6*40&&this.isAiCtrl){\r\n                            this.isAiCtrl=false;\r\n                            //gm.playerScript.releaseAllKey();\r\n                            gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.w,\"keyup\")); \r\n                            gm.playerScript.enableInput=true; \r\n                        }else if(sizeOne.y<sizeTwo.y+4*40&&!this.isAiCtrl){\r\n                            actor.node.y=sizeTwo.y+2*40;\r\n                            actor.isTouchLand=true;\r\n                        }\r\n                }\r\n            }else{\r\n                actor.isOnCirrus=true;\r\n                actor.isLeftOrRight()?\r\n                (actor.turnLeft(),actor.node.x=this.node.x+10):\r\n                (actor.turnRight(),actor.node.x=this.node.x-10);\r\n                actor.fsm.switchState(\"climb\");\r\n            }\r\n        }\r\n    }\r\n});\r\n"]}