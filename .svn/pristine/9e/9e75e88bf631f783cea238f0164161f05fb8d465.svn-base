{"version":3,"sources":["fish.js"],"names":["Actor","require","FSM","Fly","Swim","Die","cc","Class","extends","properties","init","actorType","arguments","color","state","moveDir","dir","DIR","DIR_LEFT","animation","node","getComponent","Animation","hDefSpe","vDefSpe","defFlySpe","vDefAcce","vOrignSpe","fsm","addState","ENUM","FISH_STATE","FLY","setDefaultState","SWIM","turnRight","scaleX","DIR_RIGHT","turnLeft","interactive","actor","isDie","sizeOne","getSize","sizeTwo","actorCollsition","isFlashing","die","isInvincible","y","height","isUpOrDown","littleJump","getFormState","FORM_STATE","SMALL","switchStateWithStack","switchState","size","getContentSize","width","rect","x","EM","emit","type","SCORE_EFFECT","v2","pause","isPause","pauseAllActions","resume","resumeAllActions","onCollsiWithPBullet","bullet","update","dt","move","isOutScreen","removeFromParent"],"mappings":"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","file":"fish.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\monster","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar Actor=require(\"actor\");\r\nvar FSM=require(\"FSM\");\r\nvar {Fly,Swim,Die}=require(\"fishState\");\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    init(){\r\n        this.actorType=arguments[0];\r\n        this.color=arguments[1];\r\n        this.state=arguments[2];\r\n        this.moveDir=arguments[3];\r\n        this.dir=DIR.DIR_LEFT;\r\n        this.animation=this.node.getComponent(cc.Animation);\r\n        this.hDefSpe=50;\r\n        this.vDefSpe=-380;\r\n        this.defFlySpe=320;\r\n        this.vDefAcce=-500;\r\n        this.vOrignSpe=200;\r\n\r\n        this.fsm=new FSM();\r\n        this.fsm.addState(new Fly(this,\"fly\"));\r\n        this.fsm.addState(new Die(this,\"die\"));\r\n        this.fsm.addState(new Swim(this,\"swim\"));\r\n\r\n        switch(this.state){\r\n            case ENUM.FISH_STATE.FLY:\r\n            this.fsm.setDefaultState(\"fly\");\r\n            break;\r\n            case ENUM.FISH_STATE.SWIM:\r\n            this.fsm.setDefaultState(\"swim\");\r\n            break;\r\n        }\r\n        \r\n    },\r\n    turnRight(){\r\n        this.node.scaleX=-1;\r\n        this.dir=DIR.DIR_RIGHT;\r\n    },\r\n    turnLeft(){\r\n        this.node.scaleX=1;\r\n        this.dir=DIR.DIR_LEFT;\r\n    },\r\n    interactive(actor){\r\n        if(this.isDie||actor.isDie)return;\r\n        let sizeOne=actor.getSize();\r\n        let sizeTwo=this.getSize();\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            if(this.state===ENUM.FISH_STATE.FLY){\r\n                //闪烁状态碰到怪物\r\n                if(actor.isFlashing){\r\n                    this.die();\r\n                }            //无敌状态碰到怪物\r\n                else if(actor.isInvincible){\r\n                    //踩到怪物\r\n                    if(sizeOne.y>=sizeTwo.y+sizeTwo.height/2&&!actor.isUpOrDown()){\r\n                        actor.littleJump();\r\n                        actor.node.y=sizeTwo.y+sizeTwo.height+1;\r\n                        this.die();\r\n                    }\r\n                }\r\n                //普通状态碰到蘑菇\r\n                else{\r\n                    //踩到蘑菇\r\n                    if(sizeOne.y>=sizeTwo.y+sizeTwo.height/2&&!actor.isUpOrDown()){\r\n                        actor.littleJump();\r\n                        actor.node.y=sizeTwo.y+sizeTwo.height+1;\r\n                        this.die();\r\n                    }else if(actor.getFormState()!==FORM_STATE.SMALL){\r\n                        actor.fsm.switchStateWithStack(\"to_small\");\r\n                    }else{\r\n                        actor.fsm.switchState(\"die\");\r\n                    }\r\n                }\r\n            }else if(this.state===ENUM.FISH_STATE.SWIM){\r\n                \r\n                //闪烁状态碰到怪物\r\n                if(actor.isFlashing){\r\n                    this.die();\r\n                }\r\n                else if(actor.isInvincible){\r\n\r\n                }\r\n                else {\r\n                    if(actor.getFormState()!==FORM_STATE.SMALL){\r\n                        actor.fsm.switchStateWithStack(\"to_small\");\r\n                    }else{\r\n                        actor.fsm.switchState(\"die\");\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    getSize(){\r\n        let size=this.node.getContentSize();\r\n        let height=size.height-4;\r\n        let width=size.width-4;\r\n        return cc.rect(this.node.x,this.node.y,width,height);\r\n    },\r\n    die(){\r\n        this.fsm.switchState(\"die\");\r\n        EM.emit(EM.type.SCORE_EFFECT,cc.v2(this.node.x,this.node.y+80),200);\r\n    },\r\n    pause(){\r\n        this.isPause=true;\r\n        this.animation.pause();\r\n        this.node.pauseAllActions();\r\n    },\r\n    resume(){\r\n        this.isPause=false;\r\n        this.animation.resume();\r\n        this.node.resumeAllActions();\r\n    },\r\n    onCollsiWithPBullet(bullet){\r\n        bullet.die();\r\n        this.die();\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n\r\n    update (dt) {\r\n        if(this.isPause)return;\r\n\r\n        this.move(dt);\r\n\r\n        if(this.isOutScreen()){\r\n            this.node.removeFromParent();\r\n        }\r\n    }\r\n});\r\n"]}