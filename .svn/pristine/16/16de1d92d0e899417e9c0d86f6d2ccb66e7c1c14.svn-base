{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\posMgr.js"],"names":["require","MoveCmd","cc","Class","extends","Component","properties","init","currMapFixed","global","isGameOver","posLayer","gm","mapMgr","posObjects","utils","deepClone","getObjects","startObj","getObject","endObj","startPos","objectPosToMapPos","v2","x","y","endPos","currPlayer","setPosition","config","mapConfig","startType","getRound","playerScript","enableInput","aiCtrl","addCmd","macro","KEY","d","mapFixeds","i","length","name","ENUM","POSITION_TYPE","MAP_FIXED","push","splice","resetObjects","update","dt","active","EM","emit","type","PLAYER_TO_END","mapFixed","setMapToPos","pos","node","paseTile","tilePosToPos","toTiledPos","hPipeEntry","args","split","desObj","mapPos","desPos","desMapPos","parseInt","moveLeft","moveTo","PIPE_POS_TYPE","LAND","runAction","sequence","callFunc","landCallBack","AIR","airCallBack","vPipeEntry","moveDown","moveBy","ROUND","selectRound","setRound","setTimeout","GAME_PASS","bind","log","target","data","fadeOut","fadeIn","delay","delayTime","fsm","switchState","monsterMgr","removeAllChildren","propMgr","isPause","enableMapMove","worldPos","convertToWorldSpace","removeCurrMapFixed"],"mappings":"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","file":"posMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar {MoveCmd}=require(\"aiCtrl\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    init(){\r\n        this.currMapFixed=0;\r\n        global.isGameOver=false;\r\n        this.posLayer=gm.mapMgr.posLayer;\r\n        this.posObjects=utils.deepClone(this.posLayer.getObjects());\r\n        let startObj=this.posLayer.getObject(\"start\");\r\n        let endObj=this.posLayer.getObject(\"end\");\r\n        let startPos=this.objectPosToMapPos(cc.v2(startObj.x,startObj.y));\r\n        let endPos=null;\r\n        if(endObj){\r\n            endPos=this.objectPosToMapPos(cc.v2(endObj.x,endObj.y));\r\n            this.endPos=cc.v2(endPos.x+20,endPos.y);\r\n        }\r\n        this.startPos=cc.v2(startPos.x+20,startPos.y);\r\n\r\n        gm.currPlayer.setPosition(this.startPos);\r\n        if(config.mapConfig.startType[global.getRound()]){\r\n            gm.playerScript.enableInput=false;\r\n            gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.d,\"keydown\"));\r\n        }\r\n        //地图固定点\r\n        this.mapFixeds=[];\r\n        for(let i=0;i<this.posObjects.length;i++){\r\n            if(this.posObjects[i].name===ENUM.POSITION_TYPE.MAP_FIXED){\r\n                this.mapFixeds.push(this.posObjects.splice(i,1)[0]);\r\n                i--;\r\n            }\r\n        }\r\n    },\r\n    resetObjects(){\r\n        this.posObjects=utils.deepClone(this.posLayer.getObjects());\r\n    },\r\n    update (dt) {\r\n        //检测玩家是否走到终点\r\n        if(this.endPos&&gm.currPlayer.x>=this.endPos.x&&gm.currPlayer.x<=this.endPos.x+20&&!global.isGameOver){\r\n            gm.currPlayer.active=false;\r\n            global.isGameOver=true;\r\n            EM.emit(EM.type.PLAYER_TO_END);\r\n        }\r\n\r\n        //检测地图固定点\r\n        this.mapFixed();\r\n    },\r\n    setMapToPos(pos){\r\n        gm.node.setPosition(pos);\r\n        gm.mapMgr.paseTile(true);\r\n    },\r\n    objectPosToMapPos(pos){\r\n        return gm.mapMgr.tilePosToPos(gm.mapMgr.toTiledPos(pos));\r\n    },\r\n    hPipeEntry(type,pos){\r\n        let args=type.split(\"_\");\r\n        let desObj=this.posLayer.getObject(\"pipeEnd_\"+args[2]);\r\n        let mapPos=this.objectPosToMapPos(cc.v2(desObj.x,desObj.y));\r\n        //let screenPos=gm.mapMgr.mapPosToScreenPos(mapPos);\r\n        let desPos=cc.v2(mapPos.x+40,mapPos.y);\r\n        let desMapPos=cc.v2(-desPos.x+40*parseInt(args[3])-320,gm.node.y);\r\n        let moveLeft=cc.moveTo(1,pos);\r\n\r\n        switch(args[1]){\r\n            case ENUM.PIPE_POS_TYPE.LAND:\r\n                gm.currPlayer.runAction(cc.sequence(moveLeft,cc.callFunc(this.landCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n            case ENUM.PIPE_POS_TYPE.AIR:\r\n                gm.currPlayer.runAction(cc.sequence(moveLeft,cc.callFunc(this.airCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n        }\r\n    },\r\n    vPipeEntry(type,pos){\r\n        let args=type.split(\"_\");\r\n        let moveDown=cc.moveBy(1,cc.v2(0,-80));\r\n\r\n        if(args[0]===ENUM.POSITION_TYPE.ROUND){\r\n            gm.currPlayer.runAction(cc.sequence(moveDown,cc.callFunc(this.selectRound,this)));\r\n            global.setRound((parseInt(args[1])-1)*4);\r\n            setTimeout(function(){\r\n                EM.emit(EM.type.GAME_PASS);\r\n            }.bind(this),2000);\r\n            \r\n            return;\r\n        }\r\n\r\n        let desObj=this.posLayer.getObject(\"pipeEnd_\"+args[2]);\r\n        let mapPos=this.objectPosToMapPos(cc.v2(desObj.x,desObj.y));\r\n        //let screenPos=gm.mapMgr.mapPosToScreenPos(mapPos);\r\n        let desPos=cc.v2(mapPos.x+40,mapPos.y);\r\n        let desMapPos=cc.v2(-desPos.x+40*parseInt(args[3])-320,gm.node.y);\r\n\r\n        switch(args[1]){\r\n            case ENUM.PIPE_POS_TYPE.LAND:\r\n                gm.currPlayer.runAction(cc.sequence(moveDown,cc.callFunc(this.landCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n            case ENUM.PIPE_POS_TYPE.AIR:\r\n                gm.currPlayer.runAction(cc.sequence(moveDown,cc.callFunc(this.airCallBack,this,{desPos:desPos,desMapPos:desMapPos})));\r\n            break;\r\n        }\r\n    },  \r\n    selectRound(){\r\n        cc.log(\"next\");\r\n    },\r\n    landCallBack(target,data){\r\n        let fadeOut=cc.fadeOut(0.05);\r\n        let fadeIn=cc.fadeIn(0.05);\r\n        let delay=cc.delayTime(0.2);\r\n        gm.node.runAction(cc.sequence(fadeOut,cc.callFunc(function(target,data){\r\n            gm.currPlayer.setPosition(cc.v2(data.desPos.x,data.desPos.y));\r\n            this.setMapToPos(data.desMapPos);\r\n            gm.playerScript.fsm.switchState(\"stand\");\r\n            gm.monsterMgr.node.removeAllChildren();\r\n            gm.propMgr.node.removeAllChildren();\r\n            gm.monsterMgr.resetObjects();\r\n            gm.propMgr.resetObjects();\r\n        },this,data),delay,cc.callFunc(function(){\r\n            gm.currPlayer.runAction(cc.sequence(cc.moveBy(1,cc.v2(0,80)),cc.callFunc(function(){\r\n                gm.playerScript.isPause=false;\r\n                gm.playerScript.enableInput=true;\r\n                gm.enableMapMove=true;\r\n            },this)));\r\n        },this),fadeIn));\r\n    },\r\n    airCallBack(target,data){\r\n        let fadeOut=cc.fadeOut(0.05);\r\n        let fadeIn=cc.fadeIn(0.05);\r\n        let delay=cc.delayTime(0.5);\r\n        gm.node.runAction(cc.sequence(fadeOut,cc.callFunc(function(target,data){\r\n            gm.currPlayer.setPosition(data.desPos);\r\n            this.setMapToPos(data.desMapPos);\r\n            gm.playerScript.fsm.switchState(\"stand\");\r\n            gm.monsterMgr.node.removeAllChildren();\r\n            gm.propMgr.node.removeAllChildren();\r\n            gm.monsterMgr.resetObjects();\r\n            gm.propMgr.resetObjects();\r\n        },this,data),delay,fadeIn,cc.callFunc(function(){\r\n            gm.playerScript.isPause=false;\r\n            gm.playerScript.enableInput=true;\r\n            gm.enableMapMove=true;\r\n        },this)));\r\n    },\r\n    mapFixed(){\r\n        if(!gm.enableMapMove)return;\r\n        for(let i=0;i<this.mapFixeds.length;i++){\r\n            //cc.log(this.mapFixeds[i]);\r\n            let pos=this.objectPosToMapPos(cc.v2(this.mapFixeds[i].x,this.mapFixeds[i].y));\r\n            let worldPos=gm.node.convertToWorldSpace(cc.v2(pos.x+39,pos.y));\r\n            if(worldPos.x>0&&worldPos.x<=640){\r\n                this.currMapFixed=i;\r\n                gm.node.x+=640-worldPos.x-1;\r\n                gm.enableMapMove=false;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    removeCurrMapFixed(){\r\n        this.mapFixeds.splice(this.currMapFixed,1);\r\n    }\r\n});\r\n"]}