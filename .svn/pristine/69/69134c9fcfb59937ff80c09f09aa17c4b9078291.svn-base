{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\prop/assets\\script\\prop\\aex.js"],"names":["Actor","require","MoveCmd","cc","Class","extends","properties","getSize","size","node","getContentSize","rect","x","y","width","height","init","isCollsi","interactive","actor","EM","emit","type","STOP_READTIME","gm","monsterMgr","isBossDie","playerScript","enableInput","releaseAllKey","aiCtrl","addCmd","macro","KEY","d","posMgr","removeCurrMapFixed","enableMapMove","fixOffset","position","pause","playDropAni","currBoss","fsm","switchState","setTimeout","resume","boss","removeFromParent","removeAllChildren","addChild","rosePos","mapMgr","toTiledPos","v2","runAction","sequence","delayTime","callFunc","sceneLayer","setTileGIDAt","schedule","setObstacleGidAt","bind","update","dt","isOutScreen"],"mappings":"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","file":"aex.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\prop","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar Actor=require(\"actor\");\r\nvar {MoveCmd}=require(\"aiCtrl\");\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    getSize(){\r\n        let size=this.node.getContentSize();\r\n        return cc.rect(this.node.x,this.node.y,size.width,size.height);\r\n    },\r\n    init(){\r\n        this.isCollsi=false;\r\n    },\r\n    interactive(actor){\r\n        if(this.isCollsi)return;\r\n        if(this.node.x<actor.node.x){\r\n            this.isCollsi=true;\r\n            EM.emit(EM.type.STOP_READTIME);\r\n            if(gm.monsterMgr.isBossDie){\r\n                gm.playerScript.enableInput=false;\r\n                gm.playerScript.releaseAllKey();          \r\n                gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.d,\"keydown\"));      \r\n                gm.posMgr.removeCurrMapFixed();\r\n                gm.enableMapMove=true; \r\n                gm.fixOffset(gm.playerScript.node.position);\r\n            }else{\r\n                gm.playerScript.pause();\r\n                gm.playerScript.enableInput=false;\r\n                gm.playerScript.releaseAllKey(); \r\n                //播放拆桥动画\r\n                this.playDropAni();\r\n                gm.monsterMgr.currBoss.fsm.switchState(\"die\");\r\n                setTimeout(() => {\r\n                    gm.playerScript.resume();\r\n                    gm.playerScript.aiCtrl.addCmd(new MoveCmd(gm.playerScript,cc.macro.KEY.d,\"keydown\")); \r\n                    gm.posMgr.removeCurrMapFixed();\r\n                    gm.enableMapMove=true; \r\n                    gm.fixOffset(gm.playerScript.node.position);\r\n                },3000);\r\n            }\r\n            let boss=gm.monsterMgr.currBoss;\r\n            boss.node.removeFromParent();\r\n            gm.monsterMgr.node.removeAllChildren(); \r\n            gm.monsterMgr.node.addChild(boss.node);\r\n        }\r\n    },\r\n    playDropAni(){\r\n        this.rosePos=gm.mapMgr.toTiledPos(cc.v2(this.node.x-40,this.node.y-40));\r\n        this.node.runAction(cc.sequence(cc.delayTime(0.5),cc.callFunc(function(){\r\n            gm.mapMgr.sceneLayer.setTileGIDAt(0,this.rosePos);\r\n            this.rosePos.y++;\r\n            this.schedule(function(){\r\n                gm.mapMgr.setObstacleGidAt(cc.v2(this.rosePos.x--,this.rosePos.y,0));\r\n            }.bind(this),0.1,15);\r\n        },this)));\r\n    },\r\n\r\n    // onLoad () {},\r\n\r\n    update (dt) {\r\n        if(this.isOutScreen()){\r\n            this.node.removeFromParent();\r\n        }\r\n    }\r\n});\r\n"]}