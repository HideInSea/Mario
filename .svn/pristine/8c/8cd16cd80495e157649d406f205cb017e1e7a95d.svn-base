{"version":3,"sources":["ninjia.js"],"names":["Actor","require","JumpDir","DOWN","UP","cc","Class","extends","properties","black","Node","white","init","animation","node","getComponent","Animation","dir","DIR","DIR_LEFT","color","arguments","isOnLand","isJumpUp","isJumpDown","jumpOrignPos","moveLeft","moveBy","v2","moveRight","runAction","repeatForever","sequence","scheduleFire","schedule","play","jump","jumpDir","y","Math","floor","random","jumpUp","jumpDown","turnLeft","scaleX","turnRight","DIR_RIGHT","fire","getSize","size","getContentSize","rect","x","width","height","fireStart","ENUM","MON_COLOR","BLACK","active","fireEnd","EM","emit","type","CREATE_MONSTER","getFirePos","update","dt","isPause","backPos","move","enableCollsi","tile","getDownCollsiTile","TILE_TYPE","LAND","PIPE_H_ENTRY","WALL","PIPE_V_ENTRY","QUESTION","collsiDown","getRightCollsiTile","log","collsiRight","getLeftCollsiTile","collsiLeft","vCurrSpeed","isOutScreen","removeFromParent","hCurrSpeed","oldPos","vCurrAcceleration","pause","unschedule","resume","onCollsiWithPBullet","bullet","die","isDie","scaleY","hCurrAcceleration","stopAllActions","interactive","actor","sizeOne","sizeTwo","actorCollsition","isFlashing","isInvincible","isUpOrDown","littleJump","getFormState","FORM_STATE","SMALL","fsm","switchStateWithStack","switchState","position","onCollsiPushWall","wallBox"],"mappings":"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","file":"ninjia.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\monster","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar Actor=require(\"actor\");\r\nvar JumpDir={\r\n    DOWN:0,\r\n    UP:1\r\n}\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        black:cc.Node,\r\n        white:cc.Node\r\n    },\r\n    init(){\r\n        this.animation=this.node.getComponent(cc.Animation);       \r\n        this.dir=DIR.DIR_LEFT;\r\n        this.color=arguments[1];\r\n        this.isOnLand=true;\r\n        this.isJumpUp=false;\r\n        this.isJumpDown=false;\r\n        this.jumpOrignPos=null;\r\n        \r\n        let moveLeft=cc.moveBy(1,cc.v2(-40,0));\r\n        let moveRight=cc.moveBy(1,cc.v2(40,0));\r\n        this.node.runAction(cc.repeatForever(cc.sequence(moveLeft,moveRight)));\r\n\r\n        this.scheduleFire();\r\n        this.schedule(this.scheduleFire,8);\r\n        this.animation.play(\"ninjia_walk\");\r\n        this.schedule(this.jump,6);\r\n    },\r\n    jump(){\r\n        if(!this.isOnLand)return;\r\n        let jumpDir=null;\r\n        if(this.node.y>=10*40){\r\n            jumpDir=JumpDir.DOWN;\r\n        }else if(this.node.y>=6*40){\r\n            jumpDir=Math.floor(Math.random()*2);\r\n        }else{\r\n            jumpDir=JumpDir.UP;\r\n        }\r\n\r\n        if(jumpDir===JumpDir.UP){\r\n            this.jumpUp();\r\n        }else{\r\n            this.jumpDown();\r\n        }\r\n    },\r\n    turnLeft(){\r\n        this.dir=DIR.DIR_LEFT;\r\n        this.node.scaleX=1;\r\n    },\r\n    turnRight(){\r\n        this.dir=DIR.DIR_RIGHT;\r\n        this.node.scaleX=-1;\r\n    },\r\n    scheduleFire(){\r\n        this.schedule(this.fire,1,5);\r\n    },\r\n    fire(){\r\n        this.animation.play(\"ninjia_fire\");\r\n    },\r\n    getSize(){\r\n        let size=this.node.getContentSize();\r\n        return cc.rect(this.node.x,this.node.y,size.width,size.height);\r\n    },  \r\n    fireStart(){\r\n        this.color===ENUM.MON_COLOR.BLACK?\r\n        this.black.active=true:\r\n        this.white.active=true;\r\n    },\r\n    fireEnd(){\r\n        let dir=this.dir===DIR.DIR_LEFT?\"left\":\"right\";\r\n        let color=\"\";\r\n        if(this.color===ENUM.MON_COLOR.BLACK){\r\n            this.black.active=false;\r\n            color=\"black\";\r\n        }else{\r\n            this.white.active=false;\r\n            color=\"white\";\r\n        } \r\n        EM.emit(EM.type.CREATE_MONSTER,this.getFirePos(),\"aex_\"+color+\"_\"+dir);\r\n        this.animation.play(\"ninjia_walk\");\r\n    },\r\n    getFirePos(){\r\n        return cc.v2(this.black.x+this.node.x,this.black.y+this.node.y);\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n    update (dt) {\r\n        if(this.isPause)return;\r\n\r\n        this.backPos();\r\n\r\n        this.move(dt);\r\n\r\n        if(this.enableCollsi){    \r\n            //脚底的碰撞检测\r\n            let tile=this.getDownCollsiTile();\r\n            if(tile.type){\r\n                //cc.log(tile.type);\r\n                switch(tile.type){\r\n                    case TILE_TYPE.LAND:\r\n                    case TILE_TYPE.PIPE_H_ENTRY:\r\n                    case TILE_TYPE.WALL: \r\n                    case TILE_TYPE.PIPE_V_ENTRY:\r\n                    case TILE_TYPE.QUESTION:\r\n                        this.collsiDown(tile.tile);\r\n                    break;\r\n                }\r\n            }else{\r\n                if(this.isOnLand){\r\n                    this.isOnLand=false;\r\n                }\r\n            }\r\n    \r\n            //右侧的碰撞检测\r\n            tile=this.getRightCollsiTile();\r\n            if(tile.type){\r\n                cc.log(tile.type);\r\n                switch(tile.type){\r\n                    case TILE_TYPE.LAND:\r\n                    case TILE_TYPE.PIPE_V_ENTRY:\r\n                    case TILE_TYPE.WALL:\r\n                    case TILE_TYPE.QUESTION:    \r\n                    case TILE_TYPE.PIPE_H_ENTRY:\r\n                    this.collsiRight(tile.tile);\r\n                    break;\r\n\r\n                }\r\n            }\r\n    \r\n            //左侧的碰撞检测\r\n            tile=this.getLeftCollsiTile();\r\n            if(tile.type){\r\n                cc.log(tile.type);\r\n                switch(tile.type){\r\n                    case TILE_TYPE.LAND:\r\n                    case TILE_TYPE.PIPE_V_ENTRY:\r\n                    case TILE_TYPE.WALL:\r\n                    case TILE_TYPE.QUESTION:     \r\n                    case TILE_TYPE.PIPE_H_ENTRY:\r\n                    this.collsiLeft(tile.tile);\r\n                    break;\r\n    \r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        if(this.isJumpDown){\r\n            if(this.jumpOrignPos.y>this.node.y+120){\r\n                this.enableCollsi=true;\r\n            }\r\n        }else if(this.isJumpUp){\r\n            if(this.vCurrSpeed<0){\r\n                this.enableCollsi=true;\r\n            }\r\n        }\r\n\r\n        if(this.isOutScreen()){\r\n            this.node.removeFromParent();\r\n        }\r\n    },\r\n    collsiLeft(tile){\r\n        if(this.dir===DIR.DIR_LEFT)this.hCurrSpeed=0;\r\n        this.node.x=this.getSize().width/2+tile.node.x+40+1;\r\n    },\r\n    collsiRight(tile){\r\n        if(this.dir===DIR.DIR_RIGHT)this.hCurrSpeed=0;\r\n        this.node.x=tile.node.x-this.getSize().width/2-1; \r\n    },\r\n    collsiDown(tile){\r\n        let size=this.getSize();\r\n        if(!this.isOnLand){\r\n            if((this.oldPos.y>=tile.node.y)\r\n            &&((this.oldPos.x-size.width/2>=tile.node.x&&this.oldPos.x-size.width/2<=tile.node.x+40)\r\n            ||(this.oldPos.x+size.width/2>=tile.node.x&&this.oldPos.x+size.width/2<=tile.node.x+40))){\r\n                this.isOnLand=true;\r\n                this.isJumpDown=false;\r\n                this.isJumpUp=false;\r\n                this.node.y=tile.node.y+40;\r\n                this.vCurrSpeed=0;\r\n                this.vCurrAcceleration=0;\r\n            }\r\n        }\r\n    },\r\n    pause(){\r\n        this.isPause=true;\r\n        this.animation.pause();\r\n        this.unschedule(this.fire);\r\n    },\r\n    resume(){\r\n        this.isPause=false;\r\n        this.animation.resume();\r\n        this.schedule(this.fire,2);\r\n    },\r\n    onCollsiWithPBullet(bullet){\r\n        bullet.die();\r\n        this.die();\r\n    },\r\n    die(){\r\n        this.isDie=true;\r\n        this.node.scaleY=-1;\r\n        this.node.y+=80;\r\n        this.vCurrSpeed=300;\r\n        this.vCurrAcceleration=-1400;\r\n        this.hCurrSpeed=0;\r\n        this.hCurrAcceleration=0;\r\n        this.enableCollsi=false;\r\n        this.animation.play(\"ninjia_die\");\r\n        this.unschedule(this.scheduleFire);\r\n        this.unschedule(this.jump);\r\n        this.node.stopAllActions(); \r\n    },\r\n    interactive(actor){\r\n        if(this.isDie||actor.isDie)return;\r\n        let sizeOne=actor.getSize();\r\n        let sizeTwo=this.getSize();\r\n        if(this.actorCollsition(sizeOne,sizeTwo)){\r\n            //闪烁状态碰到怪物\r\n            if(actor.isFlashing){\r\n                this.die();\r\n            }\r\n            //无敌状态碰到怪物\r\n            else if(actor.isInvincible){\r\n                //踩到怪物\r\n                if(sizeOne.y>=sizeTwo.y+sizeTwo.height/2&&!actor.isUpOrDown()){\r\n                    actor.littleJump();\r\n                    actor.node.y=sizeTwo.y+sizeTwo.height+1;\r\n                    this.die();\r\n                }\r\n            }\r\n            //普通状态碰到蘑菇\r\n            else{\r\n                //踩到蘑菇\r\n                if(sizeOne.y>=sizeTwo.y+sizeTwo.height/2){\r\n                    actor.littleJump();\r\n                    actor.node.y=sizeTwo.y+sizeTwo.height+1;\r\n                    this.die();\r\n                }else if(actor.getFormState()!==FORM_STATE.SMALL){\r\n                    actor.fsm.switchStateWithStack(\"to_small\");\r\n                }else{\r\n                    actor.fsm.switchState(\"die\");\r\n                }\r\n            }\r\n        }else{\r\n            if(actor.node.x>this.node.x&&this.dir===DIR.DIR_LEFT){\r\n                this.turnRight();\r\n            }else if(actor.node.x<this.node.x&&this.dir===DIR.DIR_RIGHT){\r\n                this.turnLeft();\r\n            }\r\n        }\r\n    },\r\n    jumpUp(){\r\n        this.vCurrAcceleration=-1350;                   //最小加速度\r\n        this.vCurrSpeed=700;                     //加速时的初始速度\r\n        this.isJumpUp=true;\r\n        this.enableCollsi=false;\r\n    },\r\n    jumpDown(){\r\n\r\n        this.vCurrAcceleration=-1350;                   //最小加速度\r\n        this.vCurrSpeed=300;                     //加速时的初始速度\r\n        this.isJumpDown=true;\r\n        this.enableCollsi=false;\r\n        this.jumpOrignPos=this.node.position;\r\n    },\r\n    onCollsiPushWall(wallBox){\r\n        this.die();\r\n    }\r\n});\r\n"]}