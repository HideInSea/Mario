{"version":3,"sources":["propMgr.js"],"names":["cc","Class","extends","Component","properties","mushroom","Prefab","flower","star","cirrus","ladder","story","aex","baby","init","propObjs","gm","mapMgr","propLayer","getObjects","onLoad","EM","on","type","CREATE_PROP","createProp","PAUSE_ACTOR","pauseActor","RESUME_ACTOR","resumeActor","children","node","i","length","getComponent","name","pause","resume","pos","propName","args","split","prop","script","ENUM","PROP_TYPE","COIN","MUSHROOM","global","getPlayerState","FORM_STATE","SMALL","LIFE","instantiate","STAR","CIRRUS","LADDER","STORY","AEX","BABY","addChild","setPosition","apply","collsition","interactive","playerScript","collsiWithPushWall","wallBox","iteratorPropObjects","isObjectInScreen","obj","splice","tPos","toTiledPos","v2","x","y","tilePosToPos","update","dt","onDestroy","off"],"mappings":"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","file":"propMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        mushroom:cc.Prefab,\r\n        flower:cc.Prefab,\r\n        star:cc.Prefab,\r\n        cirrus:cc.Prefab,\r\n        ladder:cc.Prefab,\r\n        story:cc.Prefab,\r\n        aex:cc.Prefab,\r\n        baby:cc.Prefab\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    init(){\r\n        this.propObjs=gm.mapMgr.propLayer.getObjects();\r\n\r\n    },\r\n    onLoad () {\r\n        EM.on(EM.type.CREATE_PROP,this.createProp,this);\r\n\r\n        EM.on(EM.type.PAUSE_ACTOR,this.pauseActor,this);\r\n        EM.on(EM.type.RESUME_ACTOR,this.resumeActor,this);\r\n    },\r\n    pauseActor(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).pause();            \r\n        }\r\n    },\r\n    resumeActor(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).resume();            \r\n        }\r\n    },\r\n    createProp(pos,propName){\r\n        let args=propName.split(\"_\");\r\n        let prop=null;\r\n        let script=null;\r\n        switch(args[0]){\r\n            case ENUM.PROP_TYPE.COIN:return;\r\n            case ENUM.PROP_TYPE.MUSHROOM:\r\n                if(global.getPlayerState()===FORM_STATE.SMALL||args[1]===ENUM.PROP_TYPE.LIFE){\r\n                    prop=cc.instantiate(this.mushroom);\r\n                    script=prop.getComponent(\"mush\");\r\n                }else{\r\n                    prop=cc.instantiate(this.flower);\r\n                    script=prop.getComponent(\"flower\");\r\n                }\r\n            break;\r\n            case ENUM.PROP_TYPE.STAR:\r\n                prop=cc.instantiate(this.star);\r\n                script=prop.getComponent(\"star\");\r\n            break;\r\n            case ENUM.PROP_TYPE.CIRRUS:\r\n                prop=cc.instantiate(this.cirrus);\r\n                script=prop.getComponent(\"cirrus\");\r\n            break;\r\n            case ENUM.PROP_TYPE.LADDER:\r\n                prop=cc.instantiate(this.ladder);\r\n                script=prop.getComponent(\"ladder\");\r\n            break;\r\n            case ENUM.PROP_TYPE.STORY:\r\n                prop=cc.instantiate(this.story);\r\n                script=prop.getComponent(\"story\");\r\n            break;\r\n            case ENUM.PROP_TYPE.AEX:\r\n            prop=cc.instantiate(this.aex);\r\n            script=prop.getComponent(\"aex\");\r\n            break;\r\n            case ENUM.PROP_TYPE.BABY:\r\n            prop=cc.instantiate(this.baby);\r\n            script=prop.getComponent(\"baby\");\r\n            break;\r\n        }\r\n        this.node.addChild(prop);\r\n        prop.setPosition(pos);\r\n        script.init.apply(script,args);\r\n    },\r\n\r\n    collsition(){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).interactive(gm.playerScript);            \r\n        }\r\n    },\r\n    collsiWithPushWall(wallBox){\r\n        let children=this.node.children;\r\n        for(let i=0;i<children.length;i++){\r\n            children[i].getComponent(children[i].name).collsiWithPushWall(wallBox);            \r\n        }\r\n    },\r\n    //遍历怪物对象组，找出出现在当前屏幕中的对象\r\n    iteratorPropObjects(){\r\n        for(let i=0;i<this.propObjs.length;i++){\r\n            if(gm.mapMgr.isObjectInScreen(this.propObjs[i])){\r\n                let obj=this.propObjs.splice(i,1);\r\n                i--;\r\n                let tPos=gm.mapMgr.toTiledPos(cc.v2(obj[0].x,obj[0].y));\r\n                let pos=gm.mapMgr.tilePosToPos(tPos);\r\n                this.createProp(cc.v2(pos.x+20,pos.y),obj[0].name);\r\n            }\r\n        }\r\n    },\r\n    update (dt) {\r\n\r\n        //道具与玩家的碰撞检测\r\n        this.collsition();\r\n\r\n        //遍历道具对象组\r\n        this.iteratorPropObjects();\r\n        \r\n    },  \r\n    onDestroy(){\r\n        EM.off(EM.type.CREATE_PROP);\r\n\r\n        EM.off(EM.type.PAUSE_ACTOR);\r\n        EM.off(EM.type.RESUME_ACTOR);\r\n    }\r\n});\r\n"]}