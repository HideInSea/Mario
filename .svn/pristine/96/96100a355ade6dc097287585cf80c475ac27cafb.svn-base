{"version":3,"sources":["mapMgr.js"],"names":["cc","Class","extends","Component","properties","maps","type","TiledMapAsset","default","coin","Prefab","question","init","player","order","tm","node","getComponent","TiledMap","tmxAsset","global","getRound","mapSize","getMapSize","currCol","addChild","propMgr","getChildByName","monsterMgr","writeflagLayer","getLayer","zIndex","sceneLayer","obstacleLayer","coinLayer","endflag","pipeLayer","posLayer","getObjectGroup","monsterLayer","propLayer","hideLayer","hideObjs","getObjects","paseTile","EM","on","COLLSI_FLAG","collsiFlag","RISE_WRITE_FLAG","riseWriteFlag","setObstacleGidAt","pos","gid","setTileGIDAt","moveUp","moveBy","v2","runAction","sequence","callFunc","setTimeout","nextRound","emit","GAME_PASS","moveDown","FLAG_TOUCH_LAND","playerToEnd","onDestroy","off","screenPosToMapPos","convertToNodeSpace","mapPosToScreenPos","convertToWorldSpace","toTiledPos","Vec2","Math","floor","x","ceil","y","tilePosToPos","tilePos","getObstacleTileAt","width","tile","getTileGIDAt","paseObstacleGid","getTiledTileAt","isArrContainGid","GID","WALL","TILE_TYPE","ROPE","QUESTION","HIDE_QUESTION","COIN","PIPE_H_ENTRY","PIPE_V_ENTRY","FLAG","LAND","arr","value","isFullScreen","row","col","offset","localPos","i","j","addQuestionAni","addCoinAni","instantiate","addBrockAni","update","dt","start","Date","now","mapPos","screenPos","addPushAni","hideObj","moveup","movedown","reverse","target","data","CREATE_PROP","pushQuestion","removeAllChildren","getObjectAt","collsiWithPushWall","SOLID","COIN_EFFECT","pushHideQuestion","pushWall","getPlayerState","FORM_STATE","SMALL","PIECES_EFFECT","solid","ENUM","PROP_TYPE","count","undefined","random","collsiCoin","ADD_COIN","name","isObjectInScreen","obj","winSize","t","wallBox","rect","gm"],"mappings":"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","file":"mapMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        maps:{\r\n            type:cc.TiledMapAsset,\r\n            default:[]\r\n        },\r\n        coin:cc.Prefab,\r\n        question:cc.Prefab\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    init(player){\r\n        //解析地图数据\r\n        let order=1;\r\n        this.tm=this.node.getComponent(cc.TiledMap);\r\n        this.tm.tmxAsset=this.maps[global.getRound()];\r\n        this.mapSize=this.tm.getMapSize();\r\n        this.currCol=0;\r\n\r\n        //初始化各层之间的层级关系\r\n        this.node.addChild(player);\r\n\r\n\r\n        let propMgr=this.node.getChildByName(\"propMgr\");\r\n        let monsterMgr=this.node.getChildByName(\"monsterMgr\");\r\n\r\n        this.writeflagLayer=this.tm.getLayer(\"writeflag\");\r\n        this.writeflagLayer.node.zIndex=order++;\r\n        this.sceneLayer=this.tm.getLayer(\"scene\");\r\n        this.sceneLayer.node.zIndex=order++;\r\n\r\n        propMgr.zIndex=order++;\r\n\r\n        this.obstacleLayer=this.tm.getLayer(\"obstacle\");\r\n        this.obstacleLayer.node.zIndex=order++;\r\n\r\n        this.coinLayer=this.tm.getLayer(\"coin\");\r\n        this.coinLayer.node.zIndex=order++;\r\n\r\n        this.endflag=this.tm.getLayer(\"endflag\");\r\n        this.endflag.node.zIndex=order++;\r\n\r\n        monsterMgr.zIndex=order++;\r\n        player.zIndex=order++;\r\n\r\n        this.pipeLayer=this.tm.getLayer(\"pipe\");\r\n        this.pipeLayer.node.zIndex=order++;\r\n\r\n        this.posLayer=this.tm.getObjectGroup(\"position\");\r\n        this.monsterLayer=this.tm.getObjectGroup(\"monster\");\r\n        this.propLayer=this.tm.getObjectGroup(\"prop\");\r\n        this.hideLayer=this.tm.getObjectGroup(\"hide\");\r\n        //this.positionObjs=this.getObjects();\r\n        this.hideObjs=this.hideLayer.getObjects();\r\n\r\n        //解析一次全屏tile\r\n        this.paseTile(true);\r\n\r\n        EM.on(EM.type.COLLSI_FLAG,this.collsiFlag,this);\r\n        EM.on(EM.type.RISE_WRITE_FLAG,this.riseWriteFlag,this);\r\n        //this.obstacleLayer.setTileGIDAt(0,cc.v2(0,15));\r\n    },\r\n    //更改障碍物层某tile的gid \r\n    setObstacleGidAt(pos,gid){\r\n        this.obstacleLayer.setTileGIDAt(gid,pos);\r\n    },\r\n    //升城堡旗帜\r\n    riseWriteFlag(){\r\n        let moveUp=cc.moveBy(1,cc.v2(0,80));\r\n        this.writeflagLayer.node.runAction(cc.sequence(moveUp,cc.callFunc(function(){\r\n            setTimeout(function(){\r\n                global.nextRound();\r\n                EM.emit(EM.type.GAME_PASS);\r\n            },2000);\r\n        },this)));\r\n    },\r\n    //白旗降到地面\r\n    collsiFlag(){\r\n        let moveDown=cc.moveBy(1.2,cc.v2(0,-320));\r\n        this.endflag.node.runAction(cc.sequence(moveDown,cc.callFunc(function(){\r\n            EM.emit(EM.type.FLAG_TOUCH_LAND);\r\n        },this)));\r\n    },\r\n    //玩家走到终点\r\n    playerToEnd(){\r\n\r\n    },\r\n    onDestroy(){\r\n        EM.off(EM.type.COLLSI_FLAG);\r\n        EM.off(EM.type.RISE_WRITE_FLAG);\r\n    },\r\n    //将屏幕坐标转换成地图坐标\r\n    screenPosToMapPos(pos){\r\n        return this.node.convertToNodeSpace(pos);\r\n    },\r\n    //将地图坐标转换为屏幕坐标\r\n    mapPosToScreenPos(pos){\r\n        return this.node.convertToWorldSpace(pos);\r\n    },\r\n    //点坐标转换为tile坐标\r\n    toTiledPos(pos){\r\n        return new cc.Vec2(Math.floor(pos.x/40),Math.ceil(15-pos.y/40));\r\n    },\r\n    //将格子坐标转换为地图坐标\r\n    tilePosToPos(tilePos){\r\n        return new cc.Vec2(tilePos.x*40,(15-tilePos.y)*40);\r\n    },\r\n    //获取某地图坐标障碍物tiled\r\n    getObstacleTileAt(pos){\r\n        let tilePos=this.toTiledPos(pos);\r\n        if(tilePos.y<0||tilePos.y>15||tilePos.x<0||tilePos.x>this.mapSize.width-1)return{type:null,tile:null};\r\n        let gid=this.obstacleLayer.getTileGIDAt(tilePos);\r\n        if(gid){\r\n            let type=this.paseObstacleGid(gid);\r\n            let tile=this.obstacleLayer.getTiledTileAt(tilePos.x,tilePos.y,true);\r\n            return {type:type,tile:tile};\r\n        }\r\n        gid=this.pipeLayer.getTileGIDAt(tilePos);\r\n        if(gid){\r\n            let type=this.paseObstacleGid(gid);\r\n            let tile=this.pipeLayer.getTiledTileAt(tilePos.x,tilePos.y,true);\r\n            return {type:type,tile:tile};\r\n        }\r\n        gid=this.coinLayer.getTileGIDAt(tilePos);\r\n        if(gid){\r\n            let type=this.paseObstacleGid(gid);\r\n            let tile=this.coinLayer.getTiledTileAt(tilePos.x,tilePos.y,true);\r\n            return {type:type,tile:tile};\r\n        }\r\n        return {type:null,tile:null};\r\n    },\r\n\r\n    //解析障碍物的类型\r\n    paseObstacleGid(gid){\r\n        if(this.isArrContainGid(GID.WALL,gid)){\r\n            return TILE_TYPE.WALL;\r\n        }else if(this.isArrContainGid(GID.ROPE,gid)){\r\n            return TILE_TYPE.ROPE;\r\n        }else if(this.isArrContainGid(GID.QUESTION,gid)){\r\n            return TILE_TYPE.QUESTION;\r\n        }else if(this.isArrContainGid(GID.HIDE_QUESTION,gid)){\r\n            return TILE_TYPE.HIDE_QUESTION;\r\n        }else if(this.isArrContainGid(GID.COIN,gid)){\r\n            return TILE_TYPE.COIN;\r\n        }else if(this.isArrContainGid(GID.PIPE_H_ENTRY,gid)){\r\n            return TILE_TYPE.PIPE_H_ENTRY;\r\n        }else if(this.isArrContainGid(GID.PIPE_V_ENTRY,gid)){\r\n            return TILE_TYPE.PIPE_V_ENTRY;;\r\n        }else if(this.isArrContainGid(GID.FLAG,gid)){\r\n            return TILE_TYPE.FLAG;\r\n        }else{\r\n            return TILE_TYPE.LAND;\r\n        }\r\n    },\r\n    isArrContainGid(arr,gid){\r\n        for(let value of arr){\r\n            if(value===gid)return true;\r\n        }\r\n        return false;\r\n    },\r\n    //解析tile，根据tile的类型去添加相应的动画\r\n    paseTile(isFullScreen){  \r\n        let row=16;\r\n        let col=0,offset=0;\r\n        if(isFullScreen){\r\n            offset=16;\r\n            let localPos=this.screenPosToMapPos(cc.v2(1,0));\r\n            let tilePos=this.toTiledPos(localPos);\r\n            col=tilePos.x;\r\n            this.currCol=col;\r\n        }else{\r\n            col=this.currCol;\r\n            offset=1;\r\n        }\r\n\r\n        for(let i=col;i<col+offset;i++){\r\n            this.currCol++;\r\n            for(let j=0;j<row;j++){\r\n                if(col>=this.mapSize.width)return;\r\n                let gid=this.coinLayer.getTileGIDAt(i,j);\r\n                let type=this.paseObstacleGid(gid);\r\n                switch(type){\r\n                    case TILE_TYPE.QUESTION:\r\n                        this.addQuestionAni(this.coinLayer.getTiledTileAt(i,j,true));\r\n                    break;\r\n                    case TILE_TYPE.COIN:\r\n                        this.addCoinAni(this.coinLayer.getTiledTileAt(i,j,true));\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        //cc.log(count);\r\n        //cc.log(Date.now());\r\n    },\r\n    addCoinAni(tile){\r\n        let coin=cc.instantiate(this.coin);\r\n        coin.getComponent(\"coin\").init(tile);\r\n    },\r\n    addQuestionAni(tile){\r\n        let question=cc.instantiate(this.question);\r\n        question.getComponent(\"question\").init(tile);\r\n    },\r\n    addBrockAni(tile){\r\n        tile.gid=0;\r\n    },\r\n    update (dt) {\r\n        //dt>0.02?cc.log(dt):dt;\r\n        let start=Date.now();\r\n        let mapPos=this.tilePosToPos(new cc.Vec2(this.currCol,0));\r\n        let screenPos=this.mapPosToScreenPos(mapPos);\r\n        if(screenPos.x<680){\r\n            this.paseTile(false);\r\n        }\r\n        // let end=Date.now();\r\n        //cc.log((end-start)/1000);\r\n\r\n    },\r\n    //添加砖块被顶动作,如果存在隐藏对象，动画结束创建隐藏对象\r\n    addPushAni(tile,hideObj) {\r\n        var moveup = cc.moveBy(0.1, cc.v2(0, 20));\r\n        var movedown = moveup.reverse();\r\n        tile.node.runAction(cc.sequence(moveup, movedown,cc.callFunc(function(target,data){\r\n            if(data.hideObj)EM.emit(EM.type.CREATE_PROP,data.pos,data.hideObj);\r\n        },this,{pos:cc.v2(tile.node.x+20,tile.node.y),hideObj:hideObj})));\r\n    },\r\n\r\n    //顶问号墙\r\n    pushQuestion(tile) {\r\n        tile.node.removeAllChildren();\r\n        let hideObj=this.getObjectAt(this.hideObjs,cc.v2(tile.x,tile.y));\r\n        this.collsiWithPushWall(tile);\r\n        //红色\r\n        if (tile.gid === GID.QUESTION[1]||tile.gid===GID.HIDE_QUESTION[0]) {\r\n            tile.gid=GID.SOLID[1];\r\n        }\r\n        //蓝色\r\n        else if (tile.gid === GID.QUESTION[0]||tile.gid===GID.HIDE_QUESTION[1]) {\r\n            tile.gid=GID.SOLID[0];\r\n        }\r\n        this.addPushAni(tile,hideObj);\r\n        if(!hideObj){\r\n            EM.emit(EM.type.COIN_EFFECT, cc.v2(tile.node.x + 20, tile.node.y + 80), 200);\r\n        }\r\n    },\r\n\r\n    //顶到隐藏的问号\r\n    pushHideQuestion(tile){\r\n        this.pushQuestion(tile);\r\n    },\r\n    //顶普通墙\r\n    pushWall(tile) {\r\n        let hideObj=this.getObjectAt(this.hideObjs,cc.v2(tile.x,tile.y));\r\n        this.collsiWithPushWall(tile);\r\n        //大形态且没有隐藏道具将墙顶碎\r\n        if (global.getPlayerState()!==FORM_STATE.SMALL&&!hideObj) {\r\n            EM.emit(EM.type.PIECES_EFFECT, cc.v2(tile.node.x + 20, tile.node.y + 60), tile.gid);\r\n            tile.gid = 0;\r\n        }else{\r\n            if(hideObj){  \r\n                let solid=true;\r\n                if(hideObj===ENUM.PROP_TYPE.COIN&&tile.count===undefined){\r\n                    tile.count=Math.floor(Math.random()*3+4);\r\n                    EM.emit(EM.type.COIN_EFFECT, cc.v2(tile.node.x + 20, tile.node.y + 80), 200);\r\n                    solid=false;\r\n                }else if(hideObj===ENUM.PROP_TYPE.COIN&&tile.count>0){\r\n                    tile.count--;\r\n                    EM.emit(EM.type.COIN_EFFECT, cc.v2(tile.node.x + 20, tile.node.y + 80), 200);\r\n                    solid=false;\r\n                }else if(hideObj===ENUM.PROP_TYPE.COIN&&tile.count===0){\r\n                    EM.emit(EM.type.COIN_EFFECT, cc.v2(tile.node.x + 20, tile.node.y + 80), 200);\r\n                }\r\n\r\n                if(solid){\r\n                    switch(tile.gid){\r\n                        case GID.WALL[0]:                   //红色\r\n                        case GID.WALL[3]:\r\n                            tile.gid=GID.SOLID[1];\r\n                        break;          \r\n                        case GID.WALL[1]:                   //蓝色\r\n                        case GID.WALL[4]:\r\n                            tile.gid=GID.SOLID[0];\r\n                        break;\r\n                        case GID.WALL[2]:                   //灰色\r\n                        case GID.WALL[5]:\r\n                            tile.gid=GID.SOLID[2];\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            this.addPushAni(tile,hideObj);\r\n        }\r\n    },\r\n\r\n    //碰到金币\r\n    collsiCoin(tile) {\r\n        tile.gid = 0;\r\n        tile.node.removeAllChildren();\r\n        EM.emit(EM.type.ADD_COIN, 1);\r\n    },\r\n\r\n    //获取某对象数组指定坐标的对象\r\n    getObjectAt(arr,tilePos){\r\n        for(let value of arr){\r\n            let pos=this.toTiledPos(cc.v2(value.x,value.y));\r\n            if(tilePos.x===pos.x&&tilePos.y===pos.y){\r\n                return value.name;\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n    //判断某个对象是否出现在当前屏幕中\r\n    isObjectInScreen(obj){\r\n        let pos=this.node.convertToWorldSpace(cc.v2(obj.x,obj.y));\r\n        if(pos.x<global.winSize.width+40&&pos.x>-40){\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n    collsiWithPushWall(tile){\r\n        let t=this.getObstacleTileAt(cc.v2(tile.node.x,tile.node.y+40));\r\n        if(!t.type){\r\n            let wallBox=cc.rect(tile.node.x+20,tile.node.y+40,30,40);\r\n            gm.monsterMgr.collsiWithPushWall(wallBox);\r\n            gm.propMgr.collsiWithPushWall(wallBox);\r\n        }else if(t.type===TILE_TYPE.COIN){\r\n            t.tile.node.removeAllChildren();\r\n            t.tile.gid=0; \r\n            EM.emit(EM.type.COIN_EFFECT, cc.v2(tile.node.x + 20, tile.node.y + 80), 200);\r\n        }\r\n    }\r\n});\r\n"]}