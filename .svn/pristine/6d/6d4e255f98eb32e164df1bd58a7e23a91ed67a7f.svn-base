{"version":3,"sources":["wheel.js"],"names":["Actor","require","cc","Class","extends","properties","left","Node","right","white","SpriteFrame","red","ladder","Prefab","init","actorType","arguments","color","type","isPause","leftOldPos","rightOldPos","isDroping","rightObj","gm","posMgr","posLayer","getObject","mapPos","objectPosToMapPos","v2","x","y","leftHeight","parseInt","rightHeight","totalHeight","leftPos","node","position","rightPos","args","leftLadder","instantiate","propMgr","addChild","setPosition","leftScript","getComponent","name","apply","rightLadder","rightScript","ENUM","PROP_COLOR","WHITE","Sprite","spriteFrame","backLadderPos","fixRole","scaleY","fixHeight","leftOffset","rightOffset","getSize","rect","dropLadder","update","dt","isDropLadder","vCurrAcceleration","isOutScreen","removeFromParent","pause","resume","interactive","actor","isDie","pos","convertToWorldSpace","global","winSize","width","height","leftSize","rightSize"],"mappings":"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","file":"wheel.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\prop","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar Actor=require(\"actor\");\r\ncc.Class({\r\n    extends:Actor,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        left:cc.Node,\r\n        right:cc.Node,\r\n        white:cc.SpriteFrame,\r\n        red:cc.SpriteFrame,\r\n        ladder:cc.Prefab,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n    init(){\r\n        this.actorType=arguments[0];\r\n        this.color=arguments[1]\r\n        this.type=arguments[2];\r\n        this.isPause=false;\r\n        this.leftOldPos=null;\r\n        this.rightOldPos=null;\r\n        this.isDroping=false;\r\n\r\n        let rightObj=gm.posMgr.posLayer.getObject(\"wheelEnd_\"+arguments[3]);\r\n        let mapPos=gm.posMgr.objectPosToMapPos(cc.v2(rightObj.x,rightObj.y));\r\n\r\n        this.leftHeight=parseInt(arguments[4])*40;\r\n        this.rightHeight=parseInt(arguments[5])*40;\r\n        this.totalHeight=this.leftHeight+this.rightHeight;\r\n        this.leftPos=this.node.position;\r\n        this.rightPos=cc.v2(mapPos.x+20,mapPos.y);\r\n        this.right.x=this.rightPos.x-this.node.x;\r\n\r\n        let args=[\"ladder\",this.type,\"stop\"];\r\n\r\n        this.leftLadder=cc.instantiate(this.ladder);\r\n        gm.propMgr.node.addChild(this.leftLadder);\r\n        this.leftLadder.setPosition(cc.v2(this.leftPos.x,this.leftPos.y-this.leftHeight));\r\n        this.leftScript=this.leftLadder.getComponent(this.leftLadder.name);\r\n        this.leftScript.init.apply(this.leftScript,args);\r\n\r\n        this.rightLadder=cc.instantiate(this.ladder);\r\n        gm.propMgr.node.addChild(this.rightLadder);\r\n        this.rightLadder.setPosition(cc.v2(this.rightPos.x,this.rightPos.y-this.rightHeight));\r\n        this.rightScript=this.rightLadder.getComponent(this.rightLadder.name);\r\n        this.rightScript.init.apply(this.rightScript,args);\r\n\r\n        if(this.color===ENUM.PROP_COLOR.WHITE){\r\n            this.left.getComponent(cc.Sprite).spriteFrame=this.white;\r\n            this.right.getComponent(cc.Sprite).spriteFrame=this.white;\r\n        }else{\r\n            this.left.getComponent(cc.Sprite).spriteFrame=this.red;\r\n            this.right.getComponent(cc.Sprite).spriteFrame=this.red;\r\n        }\r\n\r\n        this.backLadderPos();\r\n        this.fixRole();\r\n    },\r\n    fixRole(){\r\n        this.left.scaleY=(this.node.y-this.leftLadder.y)/40;\r\n        this.right.scaleY=(this.node.y-this.rightLadder.y)/40;\r\n    },\r\n    fixHeight(){\r\n        let leftOffset=this.leftLadder.y-this.leftOldPos.y;\r\n        let rightOffset=this.rightLadder.y-this.rightOldPos.y;\r\n        if(leftOffset!=0){\r\n            this.rightLadder.y-=leftOffset;\r\n        }else if(rightOffset!=0){\r\n            this.leftLadder.y-=rightOffset;\r\n        }\r\n    },\r\n    getSize(){\r\n        return cc.rect(0,0,0,0);\r\n    },  \r\n    dropLadder(){\r\n\r\n    },\r\n    backLadderPos(){\r\n        this.leftOldPos=this.leftLadder.position;\r\n        this.rightOldPos=this.rightLadder.position;\r\n    },\r\n    update (dt) {\r\n        if(this.isPause)return;\r\n      \r\n        if(this.isDropLadder()&&!this.isDroping){\r\n            this.dropLadder();\r\n            this.isDroping=true;\r\n        }\r\n\r\n        if(this.isDroping){\r\n            this.leftScript.vCurrAcceleration=-1300;\r\n            this.rightScript.vCurrAcceleration=-1300;\r\n\r\n        }else{\r\n            this.fixHeight();\r\n\r\n            this.fixRole();\r\n    \r\n            this.backLadderPos();\r\n        }\r\n\r\n        if(this.isOutScreen()){\r\n            this.node.removeFromParent();\r\n        }\r\n    },\r\n    pause(){\r\n\r\n    },\r\n    resume(){\r\n\r\n    },\r\n    interactive(actor){\r\n        if(actor.isDie)return;\r\n\r\n    },\r\n    isOutScreen(){\r\n        let pos=this.node.convertToWorldSpace(cc.v2(0,0));\r\n        if(pos.x>global.winSize.width+80||pos.x<-40*10||pos.y<-120||pos.y>global.winSize.height+80){\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n    isDropLadder(){\r\n        //检测梯子是否落下\r\n        let leftSize=this.leftScript.getSize();\r\n        let rightSize=this.leftScript.getSize();\r\n        if(this.leftLadder.y+leftSize.height>this.node.y){\r\n            this.leftLadder.y=this.node.y-leftSize.height;\r\n            return true;\r\n        }else if(this.rightLadder.y+rightSize.height>this.node.y){\r\n            this.rightLadder.y=this.node.y-rightSize.height;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n});\r\n"]}